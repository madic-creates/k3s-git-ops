<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta name=author content="Michael Neese"><link href="https://madic-creates.github.io/git-ops/backup/" rel="canonical"><link href=../auth/ rel=prev><link href=../certmanager/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.22"><title>Backup - Madic | Home GitOps</title><link rel=stylesheet href=../assets/stylesheets/main.84d31ad4.min.css><link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Backup - Madic | Home GitOps"><meta property=og:description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta property=og:image content=https://madic-creates.github.io/git-ops/assets/images/social/backup.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://madic-creates.github.io/git-ops/backup/ property=og:url><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Backup - Madic | Home GitOps"><meta name=twitter:description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta name=twitter:image content=https://madic-creates.github.io/git-ops/assets/images/social/backup.png></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#backup class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Madic | Home GitOps" class="md-header__button md-logo" aria-label="Madic | Home GitOps" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Madic | Home GitOps </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Backup </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href="https://github.com/madic-creates/k3s-git-ops" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> madic-creates/k3s-git-ops </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Madic | Home GitOps" class="md-nav__button md-logo" aria-label="Madic | Home GitOps" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Madic | Home GitOps </label> <div class=md-nav__source> <a href="https://github.com/madic-creates/k3s-git-ops" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> madic-creates/k3s-git-ops </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Applications </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Applications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../argocd/ class=md-nav__link> <span class=md-ellipsis> Argo-CD </span> </a> </li> <li class=md-nav__item> <a href=../auth/ class=md-nav__link> <span class=md-ellipsis> Authentication </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Backup </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Backup </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#notifications class=md-nav__link> <span class=md-ellipsis> Notifications </span> </a> <nav class=md-nav aria-label=Notifications> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pushgateway-integration class=md-nav__link> <span class=md-ellipsis> Pushgateway Integration </span> </a> <nav class=md-nav aria-label="Pushgateway Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=#metrics-published class=md-nav__link> <span class=md-ellipsis> Metrics Published </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> <span class=md-ellipsis> 📝 Environment Variables </span> </a> </li> <li class=md-nav__item> <a href=#rclone class=md-nav__link> <span class=md-ellipsis> rclone </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../certmanager/ class=md-nav__link> <span class=md-ellipsis> Cert-Manager </span> </a> </li> <li class=md-nav__item> <a href=../databases/ class=md-nav__link> <span class=md-ellipsis> Databases </span> </a> </li> <li class=md-nav__item> <a href=../kubedoom/ class=md-nav__link> <span class=md-ellipsis> Kube DOOM </span> </a> </li> <li class=md-nav__item> <a href=../network/ class=md-nav__link> <span class=md-ellipsis> Network </span> </a> </li> <li class=md-nav__item> <a href=../loadbalancer/ class=md-nav__link> <span class=md-ellipsis> LoadBalancer </span> </a> </li> <li class=md-nav__item> <a href=../monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../reflector/ class=md-nav__link> <span class=md-ellipsis> Reflector </span> </a> </li> <li class=md-nav__item> <a href=../secretmanagement/ class=md-nav__link> <span class=md-ellipsis> Secret Management </span> </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> <span class=md-ellipsis> Storage </span> </a> </li> <li class=md-nav__item> <a href=../updates/ class=md-nav__link> <span class=md-ellipsis> Updates </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../operations/longhorn-maintenance/ class=md-nav__link> <span class=md-ellipsis> Longhorn Maintenance </span> </a> </li> <li class=md-nav__item> <a href=../operations/cilium-migration/ class=md-nav__link> <span class=md-ellipsis> Migration to Cilium </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../helm/ class=md-nav__link> <span class=md-ellipsis> Helm </span> </a> </li> <li class=md-nav__item> <a href=../secrets/ class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> <li class=md-nav__item> <a href=../mkdocs/ class=md-nav__link> <span class=md-ellipsis> MKDocs </span> </a> </li> <li class=md-nav__item> <a href=../pre-commit-hooks/ class=md-nav__link> <span class=md-ellipsis> Pre-Commit-Hooks </span> </a> </li> <li class=md-nav__item> <a href=../testenv/ class=md-nav__link> <span class=md-ellipsis> Test Environment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#notifications class=md-nav__link> <span class=md-ellipsis> Notifications </span> </a> <nav class=md-nav aria-label=Notifications> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pushgateway-integration class=md-nav__link> <span class=md-ellipsis> Pushgateway Integration </span> </a> <nav class=md-nav aria-label="Pushgateway Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=#metrics-published class=md-nav__link> <span class=md-ellipsis> Metrics Published </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#environment-variables class=md-nav__link> <span class=md-ellipsis> 📝 Environment Variables </span> </a> </li> <li class=md-nav__item> <a href=#rclone class=md-nav__link> <span class=md-ellipsis> rclone </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=backup>Backup<a class=headerlink href=#backup title="Permanent link">#</a></h1> <p>For backups I need a solution that backups the files within a persistend volume. I've taken a look at velero and the included backup solution from Longhorn but wasn't able to get what I want. Longhorn seems to be doing block based backups and with Velero I wasn't able to create file backups. Althoug I do not exclude that I've missed something.</p> <p>At the moment I'm evaluating restic as a sidecar container. The sidecar container uses crontab to create backups in regular intervals. The container mounts the crontab config and backup script from configmaps and reads the environment variables from a secret, which configure the backup.</p> <p>Backups with restic provide:</p> <ul> <li>✅ ... encryption</li> <li>✅ ... compression</li> <li>✅ ... deduplication</li> <li>✅ ... retention policies</li> </ul> <p>So I can upload my backup to any storage backend without leaking any data. And because of deduplication and compression a lot of storage space can be saved. Included retention policies make it easy to delete old backups.</p> <p>Script Features:</p> <ul> <li>Backup any folder to a restic supported storage backend</li> <li>Delete old backups (Daily, Weekly, Monthly, Always Keep Last)</li> <li>ntfy.sh notification on failure</li> <li>prometheus pushgateway metrics</li> </ul> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The script runs restic and uploads the backup to the storage backend. Additionally it deletes old backups. It get's the configuration from environment variables.</p> </div> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Sidecar deployment example</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-sidecar</span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/restic/restic:0.17.1</span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>          </span><span class=nt>envFrom</span><span class=p>:</span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>secretRef</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-env-configuration</span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;/usr/sbin/crond&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-d&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;6&quot;</span><span class="p p-Indicator">]</span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/backup/config</span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">config</span>
<a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=w>              </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab-config</span>
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/crontabs/root</span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>              </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab</span>
<a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-script</span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/usr/local/bin/backup.sh</span>
<a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>              </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup.sh</span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab-config</span>
<a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>          </span><span class=nt>configMap</span><span class=p>:</span>
<a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab</span>
<a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-script</span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a><span class=w>          </span><span class=nt>configMap</span><span class=p>:</span>
<a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab-backup-script</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>crontab configuration</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span>
<span class=normal><a href=#__codelineno-1-4>4</a></span>
<span class=normal><a href=#__codelineno-1-5>5</a></span>
<span class=normal><a href=#__codelineno-1-6>6</a></span>
<span class=normal><a href=#__codelineno-1-7>7</a></span>
<span class=normal><a href=#__codelineno-1-8>8</a></span>
<span class=normal><a href=#__codelineno-1-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">crontab</span>
<a id=__codelineno-1-5 name=__codelineno-1-5></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>  </span><span class=nt>crontab</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>    </span><span class=no># m h  dom mon dow   command</span>
<a id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>    </span><span class=no># Run script every hour</span>
<a id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>    </span><span class=no>0 * * * * /bin/sh /usr/local/bin/backup.sh</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>restic configuration</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1> 1</a></span>
<span class=normal><a href=#__codelineno-2-2> 2</a></span>
<span class=normal><a href=#__codelineno-2-3> 3</a></span>
<span class=normal><a href=#__codelineno-2-4> 4</a></span>
<span class=normal><a href=#__codelineno-2-5> 5</a></span>
<span class=normal><a href=#__codelineno-2-6> 6</a></span>
<span class=normal><a href=#__codelineno-2-7> 7</a></span>
<span class=normal><a href=#__codelineno-2-8> 8</a></span>
<span class=normal><a href=#__codelineno-2-9> 9</a></span>
<span class=normal><a href=#__codelineno-2-10>10</a></span>
<span class=normal><a href=#__codelineno-2-11>11</a></span>
<span class=normal><a href=#__codelineno-2-12>12</a></span>
<span class=normal><a href=#__codelineno-2-13>13</a></span>
<span class=normal><a href=#__codelineno-2-14>14</a></span>
<span class=normal><a href=#__codelineno-2-15>15</a></span>
<span class=normal><a href=#__codelineno-2-16>16</a></span>
<span class=normal><a href=#__codelineno-2-17>17</a></span>
<span class=normal><a href=#__codelineno-2-18>18</a></span>
<span class=normal><a href=#__codelineno-2-19>19</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup-env-configuration</span>
<a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=nt>stringData</span><span class=p>:</span>
<a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=w>  </span><span class=c1># Source directory to backup</span>
<a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>  </span><span class=nt>RESTIC_SOURCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/backup/config</span>
<a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>  </span><span class=c1># Backup repository (destination)</span>
<a id=__codelineno-2-9 name=__codelineno-2-9></a><span class=w>  </span><span class=nt>RESTIC_REPOSITORY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3:s3.eu-central-2.wasabisys.com/path/to/backup</span>
<a id=__codelineno-2-10 name=__codelineno-2-10></a><span class=w>  </span><span class=c1># Backup password</span>
<a id=__codelineno-2-11 name=__codelineno-2-11></a><span class=w>  </span><span class=nt>RESTIC_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;BackupPassword&gt;</span>
<a id=__codelineno-2-12 name=__codelineno-2-12></a><span class=w>  </span><span class=c1># Retention policies</span>
<a id=__codelineno-2-13 name=__codelineno-2-13></a><span class=w>  </span><span class=nt>KEEP_HOURLY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;48&quot;</span>
<a id=__codelineno-2-14 name=__codelineno-2-14></a><span class=w>  </span><span class=nt>KEEP_DAILY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;7&quot;</span>
<a id=__codelineno-2-15 name=__codelineno-2-15></a><span class=w>  </span><span class=nt>KEEP_WEEKLY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4&quot;</span>
<a id=__codelineno-2-16 name=__codelineno-2-16></a><span class=w>  </span><span class=nt>KEEP_LAST</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1&quot;</span>
<a id=__codelineno-2-17 name=__codelineno-2-17></a><span class=w>  </span><span class=c1># AWS credentials</span>
<a id=__codelineno-2-18 name=__codelineno-2-18></a><span class=w>  </span><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;SecureSuperSecretKey&gt;</span>
<a id=__codelineno-2-19 name=__codelineno-2-19></a><span class=w>  </span><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;VerySecureSuperSecretKey&gt;</span>
</code></pre></div></td></tr></table></div> <p>I won't include the backup script here, because it can change over time. The script is available in <a href="https://github.com/madic-creates/k3s-git-ops/blob/main/apps/backup-script/backup-script.yaml" target="_blank">my git repository</a> as a ConfigMap. The ConfigMap get's replicated via reflector to all namespaces so all deployments can use the same script. But after changes to the script the pods using the script need to be restarted. This can be done by deleting the pods or by rolling out a new deployment.</p> <h2 id=notifications>Notifications<a class=headerlink href=#notifications title="Permanent link">#</a></h2> <p>To get notified if a backup fails I'm using <a href="https://ntfy.sh/" target="_blank">ntfy</a>. Ntfy is a simple notification service that can be self-hosted.</p> <p><a href=../images/ntfy_backup_alert.png><img alt="ntfy backup notification" loading=lazy src=../images/ntfy_backup_alert.png style=height:600px></a></p> <h3 id=pushgateway-integration>Pushgateway Integration<a class=headerlink href=#pushgateway-integration title="Permanent link">#</a></h3> <p>Additionaly the backup script supports integration with a Prometheus Pushgateway to send custom metrics about the backup process. This enables tracking of backup duration, start time, and status.</p> <h4 id=configuration>Configuration<a class=headerlink href=#configuration title="Permanent link">#</a></h4> <p>To enable metrics pushing to the Pushgateway, the following environment variables should be configured:</p> <ul> <li><strong><code>PUSHGATEWAY_ENABLED</code></strong>: Set this to <code>"true"</code> to enable sending metrics to the Pushgateway</li> <li><strong><code>PUSHGATEWAY_URL</code></strong>: Specify the URL of the Pushgateway server where metrics should be sent to</li> </ul> <h4 id=metrics-published>Metrics Published<a class=headerlink href=#metrics-published title="Permanent link">#</a></h4> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>The metrics might change in the future. Currently I'm not realy satisfied. But maybe that's because I wasn't able to create a good grafana dashboard with them yet. I would appreciate any help. See issue <a href="https://github.com/madic-creates/k3s-git-ops/issues/3" target="_blank">#3</a></p> </div> <p>The script publishes the following metrics to the Pushgateway:</p> <ul> <li><strong><code>backup_duration_seconds</code></strong>: The time, in seconds, that the backup process took</li> <li><strong><code>backup_start_timestamp</code></strong>: The timestamp in epoch at which the backup process began</li> <li><strong><code>backup_status</code></strong>: The status of the backup process, with either <code>status="success"</code> or <code>status="failure"</code></li> </ul> <p><strong>Example Environment Configuration:</strong></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span>
<span class=normal><a href=#__codelineno-3-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=nt>PUSHGATEWAY_ENABLED</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=nt>PUSHGATEWAY_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://pushgateway.monitoring.svc.cluster.local</span>
</code></pre></div></td></tr></table></div> <h2 id=environment-variables>📝 Environment Variables<a class=headerlink href=#environment-variables title="Permanent link">#</a></h2> <p>The following environment variables are used to configure the backup script.</p> <table> <thead> <tr> <th><div style=width:180px>Environment Variable</div></th> <th>Default</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>RESTIC_SOURCE</code></td> <td>Unset</td> <td>Source directory to back up using Restic</td> </tr> <tr> <td><code>RESTIC_REPOSITORY</code></td> <td>Unset</td> <td>Destination repository for the backup</td> </tr> <tr> <td><code>RESTIC_PASSWORD</code></td> <td>Unset</td> <td>Password for encrypting the backup</td> </tr> <tr> <td><code>RESTIC_HOSTNAME</code></td> <td><code>$(hostname | cut -d '-' -f1)</code></td> <td><strong>Optional.</strong> Hostname to use for the backup. Defaults to the pod name. Especially usefull for pods with host networking.</td> </tr> <tr> <td><code>AWS_ACCESS_KEY_ID</code></td> <td>Unset</td> <td>Access key ID for authenticating with an S3 compatible storage backend</td> </tr> <tr> <td><code>AWS_SECRET_ACCESS_KEY</code></td> <td>Unset</td> <td>Secret access key for authenticating with an S3 compatible storage backend</td> </tr> <tr> <td><code>RESTIC_RETENTION_POLICIES_ENABLED</code></td> <td><code>true</code></td> <td><strong>Optional.</strong> Enable or disable retention policies</td> </tr> <tr> <td><code>KEEP_HOURLY</code></td> <td>24</td> <td><strong>Optional.</strong> Number of hourly backups to retain</td> </tr> <tr> <td><code>KEEP_DAILY</code></td> <td>7</td> <td><strong>Optional.</strong> Number of daily backups to keep</td> </tr> <tr> <td><code>KEEP_WEEKLY</code></td> <td>4</td> <td><strong>Optional.</strong> Number of weekly backups to maintain</td> </tr> <tr> <td><code>KEEP_MONTHLY</code></td> <td>12</td> <td><strong>Optional.</strong> Number of monthly backups to keep. Not implemented yet.</td> </tr> <tr> <td><code>KEEP_YEARLY</code></td> <td>0</td> <td><strong>Optional.</strong> Number of yearly backups to keep. Not implemented yet.</td> </tr> <tr> <td><code>KEEP_LAST</code></td> <td>1</td> <td><strong>Optional.</strong> Total number of most recent backups to keep, irrespective of time-based intervals</td> </tr> <tr> <td><code>NTFY_ENABLED</code></td> <td>false</td> <td><strong>Optional.</strong> Indicates whether notification via ntfy is enabled. Possible values are <code>"true"</code> or <code>"false"</code></td> </tr> <tr> <td><code>NTFY_TITLE</code></td> <td><code>${RESTIC_HOSTNAME - Backup failed}</code></td> <td><strong>Optional.</strong> Title of the ntfy notification message. Can be a string or shell command</td> </tr> <tr> <td><code>NTFY_CREDS</code></td> <td>Unset</td> <td><strong>Optional.</strong> Credentials for authenticating with the ntfy notification service. Needs to include the <code>-u</code> option</td> </tr> <tr> <td><code>NTFY_PRIO</code></td> <td>4</td> <td><strong>Optional.</strong> Priority level for the ntfy notification. Determines the importance of the notification</td> </tr> <tr> <td><code>NTFY_TAG</code></td> <td>bangbang</td> <td><strong>Optional.</strong> Tags to categorize the ntfy notification, allowing filtering or grouping of messages</td> </tr> <tr> <td><code>NTFY_SERVER</code></td> <td>ntfy.sh</td> <td><strong>Optional.</strong> URL of the ntfy server used for sending notifications</td> </tr> <tr> <td><code>NTFY_TOPIC</code></td> <td>backup</td> <td><strong>Optional.</strong> Topic on the ntfy server where the message will be sent to</td> </tr> <tr> <td><code>PUSHGATEWAY_ENABLED</code></td> <td>false</td> <td><strong>Optional.</strong> Indicates whether sending metrics to the Pushgateway is enabled. Possible values are <code>"true"</code> or <code>"false"</code></td> </tr> <tr> <td><code>PUSHGATEWAY_URL</code></td> <td>Unset</td> <td><strong>Optional.</strong> URL of the Pushgateway server for sending metrics</td> </tr> </tbody> </table> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>Example environment variables</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>RESTIC_SOURCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/backup/config</span>
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=nt>RESTIC_REPOSITORY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">s3:s3.eu-central-2.wasabisys.com/k3s-at-home-01/emby</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>RESTIC_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bDuSsDS7uWf0OGrK4y5SBvEfIKkIVcK3gGZpxsVx6Ya6PfwkWANDZo8mRaoGnCE6</span>
<a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=nt>KEEP_HOURLY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;48&quot;</span>
<a id=__codelineno-4-5 name=__codelineno-4-5></a><span class=nt>KEEP_DAILY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;7&quot;</span>
<a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=nt>KEEP_WEEKLY</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4&quot;</span>
<a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=nt>KEEP_LAST</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1&quot;</span>
<a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=nt>AWS_ACCESS_KEY_ID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1eoAeRYfHhcRsUsW</span>
<a id=__codelineno-4-9 name=__codelineno-4-9></a><span class=nt>AWS_SECRET_ACCESS_KEY</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Hlk6wZiKdrqIafYLOdMbw9Z7WfKK8W6ata</span>
<a id=__codelineno-4-10 name=__codelineno-4-10></a><span class=nt>NTFY_ENABLED</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-4-11 name=__codelineno-4-11></a><span class=nt>NTFY_TITLE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">$(hostname | cut -d &#39;-&#39; -f1) - Backup failed</span>
<a id=__codelineno-4-12 name=__codelineno-4-12></a><span class=c1># Needs to be with &quot;-u&quot;</span>
<a id=__codelineno-4-13 name=__codelineno-4-13></a><span class=nt>NTFY_CREDS</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">-u mne-adm:qhCVXJvzkf9SkjgFE9RDhtzycKbszdSnVw7fHFgS3cZCDmZMno25yfVhikrnPidS</span>
<a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=nt>NTFY_PRIO</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4&quot;</span>
<a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=nt>NTFY_TAG</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bangbang</span>
<a id=__codelineno-4-16 name=__codelineno-4-16></a><span class=nt>NTFY_SERVER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://ntfy.geekbundle.org</span>
<a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=nt>NTFY_TOPIC</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-at-home</span>
<a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=nt>PUSHGATEWAY_ENABLED</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=nt>PUSHGATEWAY_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">http://pushgateway.monitoring.svc.cluster.local:9091</span>
</code></pre></div></td></tr></table></div> <h2 id=rclone>rclone<a class=headerlink href=#rclone title="Permanent link">#</a></h2> <p>At some point I was also evaluating <a href="https://rclone.org" target="_blank">rclone</a> as a sidecar container. But it doesn't support de-duplication and I want my storage costs to be as low as possible. For history reasons I keep the script that I've written and mounted in the container.</p> <p><div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>rclone-backup.sh</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span>
<span class=normal><a href=#__codelineno-5-14>14</a></span>
<span class=normal><a href=#__codelineno-5-15>15</a></span>
<span class=normal><a href=#__codelineno-5-16>16</a></span>
<span class=normal><a href=#__codelineno-5-17>17</a></span>
<span class=normal><a href=#__codelineno-5-18>18</a></span>
<span class=normal><a href=#__codelineno-5-19>19</a></span>
<span class=normal><a href=#__codelineno-5-20>20</a></span>
<span class=normal><a href=#__codelineno-5-21>21</a></span>
<span class=normal><a href=#__codelineno-5-22>22</a></span>
<span class=normal><a href=#__codelineno-5-23>23</a></span>
<span class=normal><a href=#__codelineno-5-24>24</a></span>
<span class=normal><a href=#__codelineno-5-25>25</a></span>
<span class=normal><a href=#__codelineno-5-26>26</a></span>
<span class=normal><a href=#__codelineno-5-27>27</a></span>
<span class=normal><a href=#__codelineno-5-28>28</a></span>
<span class=normal><a href=#__codelineno-5-29>29</a></span>
<span class=normal><a href=#__codelineno-5-30>30</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=ch>#!/bin/sh</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=c1># Create run.log only if it does not exist</span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span>!<span class=w> </span>-f<span class=w> </span>/data/run.log<span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>  </span>touch<span class=w> </span>/data/run.log
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=k>fi</span>
<a id=__codelineno-5-7 name=__codelineno-5-7></a>
<a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=c1># Echo current date to run.log for logging purposes</span>
<a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>date<span class=k>)</span><span class=s2> Backup process started&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/data/run.log
<a id=__codelineno-5-10 name=__codelineno-5-10></a>
<a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=c1># Sync source to destination with a backup directory using &#39;year-month-day&#39; format</span>
<a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=nv>backup_dir</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$BUP_DST</span><span class=s2>/</span><span class=k>$(</span>hostname<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-&#39;</span><span class=w> </span>-f1<span class=k>)</span><span class=s2>-</span><span class=k>$(</span>date<span class=w> </span>+%Y-%m-%d<span class=k>)</span><span class=s2>&quot;</span>
<a id=__codelineno-5-13 name=__codelineno-5-13></a>rclone<span class=w> </span>--config<span class=w> </span>/config/rclone/rclone.conf<span class=w> </span>sync<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BUP_SRC</span><span class=s2>&quot;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$BUP_DST</span><span class=s2>/</span><span class=k>$(</span>hostname<span class=w> </span><span class=p>|</span><span class=w> </span>cut<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;-&#39;</span><span class=w> </span>-f<span class=w> </span><span class=m>1</span><span class=k>)</span><span class=s2>&quot;</span><span class=w> </span>-v<span class=w> </span>--backup-dir<span class=o>=</span><span class=s2>&quot;</span><span class=nv>$backup_dir</span><span class=s2>&quot;</span>
<a id=__codelineno-5-14 name=__codelineno-5-14></a>
<a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=c1># Calculate the date for retention time</span>
<a id=__codelineno-5-16 name=__codelineno-5-16></a><span class=nv>RETENTION_DATE</span><span class=o>=</span><span class=k>$(</span>date<span class=w> </span>-d<span class=w> </span><span class=s1>&#39;7 days ago&#39;</span><span class=w> </span>+%Y-%m-%d<span class=k>)</span>
<a id=__codelineno-5-17 name=__codelineno-5-17></a>
<a id=__codelineno-5-18 name=__codelineno-5-18></a><span class=c1># List directories and delete those older than retention time</span>
<a id=__codelineno-5-19 name=__codelineno-5-19></a>rclone<span class=w> </span>--config<span class=w> </span>/config/rclone/rclone.conf<span class=w> </span>lsf<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BUP_DST</span><span class=s2>/&quot;</span><span class=w> </span>--dirs-only<span class=w> </span><span class=p>|</span><span class=w> </span><span class=k>while</span><span class=w> </span><span class=nb>read</span><span class=w> </span>dir<span class=p>;</span><span class=w> </span><span class=k>do</span>
<a id=__codelineno-5-20 name=__codelineno-5-20></a><span class=w>  </span><span class=c1># Extract the date from the directory name</span>
<a id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>  </span><span class=nv>dir_date</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$dir</span><span class=s2>&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>awk<span class=w> </span>-F<span class=s1>&#39;-&#39;</span><span class=w> </span><span class=s1>&#39;{print $NF}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>sed<span class=w> </span><span class=s1>&#39;s#/##g&#39;</span><span class=k>)</span>
<a id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>  </span><span class=c1># Compare directory date with RETENTION_DATE</span>
<a id=__codelineno-5-23 name=__codelineno-5-23></a><span class=w>  </span><span class=k>if</span><span class=w> </span><span class=o>[</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$dir_date</span><span class=s2>&quot;</span><span class=w> </span><span class=se>\&lt;</span><span class=w> </span><span class=s2>&quot;</span><span class=nv>$RETENTION_DATE</span><span class=s2>&quot;</span><span class=w> </span><span class=o>]</span><span class=p>;</span><span class=w> </span><span class=k>then</span>
<a id=__codelineno-5-24 name=__codelineno-5-24></a><span class=w>    </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Deleting old backup directory: </span><span class=nv>$BUP_DST</span><span class=s2>/</span><span class=nv>$dir</span><span class=s2>&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/data/run.log
<a id=__codelineno-5-25 name=__codelineno-5-25></a><span class=w>    </span>rclone<span class=w> </span>--config<span class=w> </span>/config/rclone/rclone.conf<span class=w> </span>purge<span class=w> </span><span class=s2>&quot;</span><span class=nv>$BUP_DST</span><span class=s2>/</span><span class=nv>$dir</span><span class=s2>&quot;</span>
<a id=__codelineno-5-26 name=__codelineno-5-26></a><span class=w>  </span><span class=k>fi</span>
<a id=__codelineno-5-27 name=__codelineno-5-27></a><span class=k>done</span>
<a id=__codelineno-5-28 name=__codelineno-5-28></a>
<a id=__codelineno-5-29 name=__codelineno-5-29></a><span class=c1># Log the completion of the backup process</span>
<a id=__codelineno-5-30 name=__codelineno-5-30></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;</span><span class=k>$(</span>date<span class=k>)</span><span class=s2> Backup process completed&quot;</span><span class=w> </span>&gt;&gt;<span class=w> </span>/data/run.log
</code></pre></div></td></tr></table></div> This required the following config map mounted to /config/rclone/rclone.conf</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>rclone configuration</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1> 1</a></span>
<span class=normal><a href=#__codelineno-6-2> 2</a></span>
<span class=normal><a href=#__codelineno-6-3> 3</a></span>
<span class=normal><a href=#__codelineno-6-4> 4</a></span>
<span class=normal><a href=#__codelineno-6-5> 5</a></span>
<span class=normal><a href=#__codelineno-6-6> 6</a></span>
<span class=normal><a href=#__codelineno-6-7> 7</a></span>
<span class=normal><a href=#__codelineno-6-8> 8</a></span>
<span class=normal><a href=#__codelineno-6-9> 9</a></span>
<span class=normal><a href=#__codelineno-6-10>10</a></span>
<span class=normal><a href=#__codelineno-6-11>11</a></span>
<span class=normal><a href=#__codelineno-6-12>12</a></span>
<span class=normal><a href=#__codelineno-6-13>13</a></span>
<span class=normal><a href=#__codelineno-6-14>14</a></span>
<span class=normal><a href=#__codelineno-6-15>15</a></span>
<span class=normal><a href=#__codelineno-6-16>16</a></span>
<span class=normal><a href=#__codelineno-6-17>17</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=nn>---</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-6-3 name=__codelineno-6-3></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id=__codelineno-6-4 name=__codelineno-6-4></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-6-5 name=__codelineno-6-5></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rclone-config</span>
<a id=__codelineno-6-6 name=__codelineno-6-6></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">whoami</span>
<a id=__codelineno-6-7 name=__codelineno-6-7></a><span class=nt>stringData</span><span class=p>:</span>
<a id=__codelineno-6-8 name=__codelineno-6-8></a><span class=w>  </span><span class=nt>rclone.conf</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-6-9 name=__codelineno-6-9></a><span class=w>    </span><span class=no>[WasabiFrankfurt]</span>
<a id=__codelineno-6-10 name=__codelineno-6-10></a><span class=w>    </span><span class=no>type = s3</span>
<a id=__codelineno-6-11 name=__codelineno-6-11></a><span class=w>    </span><span class=no>provider = Wasabi</span>
<a id=__codelineno-6-12 name=__codelineno-6-12></a><span class=w>    </span><span class=no>env_auth = false</span>
<a id=__codelineno-6-13 name=__codelineno-6-13></a><span class=w>    </span><span class=no>access_key_id = &lt;SuperSecretImportantPrivy&gt;</span>
<a id=__codelineno-6-14 name=__codelineno-6-14></a><span class=w>    </span><span class=no>secret_access_key = &lt;VeryVerySuperSecretImportantPrivy&gt;</span>
<a id=__codelineno-6-15 name=__codelineno-6-15></a><span class=w>    </span><span class=no>region = eu-central-2</span>
<a id=__codelineno-6-16 name=__codelineno-6-16></a><span class=w>    </span><span class=no>endpoint = s3.eu-central-2.wasabisys.com</span>
<a id=__codelineno-6-17 name=__codelineno-6-17></a><span class=w>    </span><span class=no>acl =</span>
</code></pre></div></td></tr></table></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> <div class=md-social> <a href="https://github.com/madic-creates" target="_blank" rel="noopener" title="github.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="https://chaos.social/@Madic" target="_blank" rel="noopener me" title="chaos.social" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href="https://www.geekbundle.org" target="_blank" rel="noopener" title="www.geekbundle.org" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m61.7 169.4 101.5 278C92.2 413 43.3 340.2 43.3 256c0-30.9 6.6-60.1 18.4-86.6m337.9 75.9c0-26.3-9.4-44.5-17.5-58.7-10.8-17.5-20.9-32.4-20.9-49.9 0-19.6 14.8-37.8 35.7-37.8.9 0 1.8.1 2.8.2-37.9-34.7-88.3-55.9-143.7-55.9-74.3 0-139.7 38.1-177.8 95.9 5 .2 9.7.3 13.7.3 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l77.5 230.4L249.8 247l-33.1-90.8c-11.5-.7-22.3-2-22.3-2-11.5-.7-10.1-18.2 1.3-17.5 0 0 35.1 2.7 56 2.7 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l76.9 228.7 21.2-70.9c9-29.4 16-50.5 16-68.7m-139.9 29.3-63.8 185.5c19.1 5.6 39.2 8.7 60.1 8.7 24.8 0 48.5-4.3 70.6-12.1-.6-.9-1.1-1.9-1.5-2.9zm183-120.7c.9 6.8 1.4 14 1.4 21.9 0 21.6-4 45.8-16.2 76.2l-65 187.9C426.2 403 468.7 334.5 468.7 256c0-37-9.4-71.8-26-102.1M8 256a248 248 0 1 1 496 0 248 248 0 1 1-496 0m484.6 0a236.6 236.6 0 1 0-473.2 0 236.6 236.6 0 1 0 473.2 0"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["navigation.sections", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>