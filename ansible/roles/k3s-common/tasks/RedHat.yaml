---
# code: language=ansible

- name: "RedHat | Install packages"
  ansible.builtin.dnf:
    name:
      - nano
      - qemu-guest-agent
      - htop
      - iscsi-initiator-utils
    state: present

- name: "RedHat | Create k9s directory"
  ansible.builtin.file:
    path: "/opt/k9s_{{ k3s.k9s_version }}.linux-amd64"
    state: directory
    owner: root
    group: root
    mode: "0755"

- name: "RedHat | Download and unarchive k9s"
  ansible.builtin.unarchive:
    src: "https://github.com/derailed/k9s/releases/download/{{ k3s.k9s_version }}/k9s_Linux_amd64.tar.gz"
    dest: "/opt/k9s_{{ k3s.k9s_version }}.linux-amd64"
    remote_src: true
  args:
    creates: "/opt/k9s_{{ k3s.k9s_version }}.linux-amd64/k9s"
  register: k9s_download

- name: "RedHat | Link k9s binary"
  ansible.builtin.file:
    src: "/opt/k9s_{{ k3s.k9s_version }}.linux-amd64/k9s"
    dest: /usr/local/sbin/k9s
    owner: root
    group: root
    state: link
  when: k9s_download.changed
