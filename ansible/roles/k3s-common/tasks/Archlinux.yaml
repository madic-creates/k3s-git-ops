---
# code: language=ansible

- name: "Archlinux | Update archlinux-keyring"
  community.general.pacman:
    name:
      - archlinux-keyring
    state: latest

- name: "Archlinux | Install packages"
  community.general.pacman:
    name:
      - nano
      - htop
      - open-iscsi
      - k9s
      - nfs-utils

- name: "Archlinux | Install qemu-guest-agent on KVM"
  community.general.pacman:
    name: qemu-guest-agent
  when: ansible_virtualization_type == "kvm"

- name: "Archlinux | Comment out DNS servers from vagrant image"
  ansible.builtin.lineinfile:
    path: /etc/systemd/resolved.conf
    regexp: '^DNS=4\.2\.2\.1 4\.2\.2\.2 208\.67\.220\.220'
    line: '#DNS=4.2.2.1 4.2.2.2 208.67.220.220'
    backrefs: true
    state: present
  notify: "Restart systemd-resolved"
