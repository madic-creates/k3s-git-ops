---
helmCharts:
  - name: longhorn
    repo: https://charts.longhorn.io
    version: 1.9.1
    releaseName: longhorn
    namespace: longhorn
    valuesInline:
      global:
        #tolerations:
        #  - key: "dedicated"
        #    operator: "Equal"
        #    value: "prox01"
        #    effect: "NoSchedule"
      defaultSettings:
        backupTarget: s3://k3s-at-home-01@eu-central-2/
        backupTargetCredentialSecret: wasabi-secret
        orphanAutoDeletion: true
        removeSnapshotsDuringFilesystemTrim: true
        taintToleration: dedicated=prox01:NoSchedule
      longhornUI:
        replicas: 1
      longhornConversionWebhook:
        replicas: 1
      longhornAdmissionWebhook:
        replicas: 1
      longhornRecoveryBackend:
        replicas: 1
      persistence:
        reclaimPolicy: Retain
      preUpgradeChecker:
        jobEnabled: false

resources:
  - namespace.yaml

commonAnnotations:
  argocd.argoproj.io/sync-wave: "15"

patches:
  - target:
      version: v1
      kind: ConfigMap
      name: longhorn-storageclass
    patch: |-
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: longhorn-storageclass
        annotations:
          storageclass.kubernetes.io/is-default-class: "true"
  - target:
      version: v1
      kind: DaemonSet
      name: longhorn-manager
    patch: |-
      apiVersion: apps/v1
      kind: DaemonSet
      metadata:
        name: longhorn-manager
      spec:
        revisionHistoryLimit: 2
  - target:
      version: v1
      kind: Deployment
      name: longhorn-driver-deployer
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: longhorn-driver-deployer
      spec:
        revisionHistoryLimit: 2
  - target:
      version: v1
      kind: Deployment
      name: longhorn-ui
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: longhorn-ui
      spec:
        revisionHistoryLimit: 2

generators:
  - kustomize-secret-generator.yaml
