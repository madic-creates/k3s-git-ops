---
helmCharts:
  - name: longhorn
    repo: https://charts.longhorn.io
    version: 1.9.1
    releaseName: longhorn
    namespace: longhorn
    valuesInline:
      global:
        tolerations:
          - key: "dedicated"
            operator: "Equal"
            value: "prox01"
            effect: "NoSchedule"
      defaultSettings:
        backupTarget: s3://k3s-at-home-01@eu-central-2/
        backupTargetCredentialSecret: wasabi-secret
        orphanAutoDeletion: true
        removeSnapshotsDuringFilesystemTrim: true
      longhornUI:
        revisionHistoryLimit: 2
        replicas: 1
      longhornConversionWebhook:
        revisionHistoryLimit: 2
        replicas: 1
      longhornAdmissionWebhook:
        revisionHistoryLimit: 2
        replicas: 1
      longhornRecoveryBackend:
        revisionHistoryLimit: 2
        replicas: 1
      persistence:
        reclaimPolicy: Retain
      preUpgradeChecker:
        jobEnabled: false

resources:
  - namespace.yaml

commonAnnotations:
  argocd.argoproj.io/sync-wave: "15"

patches:
  - target:
      version: v1
      kind: ConfigMap
      name: longhorn-storageclass
    patch: |-
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: longhorn-storageclass
        annotations:
          storageclass.kubernetes.io/is-default-class: "true"

generators:
  - kustomize-secret-generator.yaml
