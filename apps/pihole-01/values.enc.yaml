image:
    repository: pihole/pihole
    #tag: 2024.07.0
    pullPolicy: IfNotPresent
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:WyWmKmU+iSkMQ/H+texl0+Slua4Rzo8=,iv:8bBZPmUhCrhR0xPdu755qBWr6uDtCPk3qHo9r1A8ODM=,tag:G7YzoJiSQF+5+pyR79nLEw==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:rY0frySZiklgmNV2yPJlVfeMVmk/2g0=,iv:i9L9ftmmZ0mwGknVglwrUeL+wNHEKpHivuEjswtFMxc=,tag:Oq0iXZ7+BudRCnr219Gi4w==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-01
          hosts:
            - ENC[AES256_GCM,data:EWcUk58EALtVSyTbh+1L6idVVY198jI=,iv:E4Fil5eTPrC/0B88b/wRkLJTsqAQpClUm7FFsa2NCQU=,tag:cKDwLINvxW5Lo5kPtPrh1w==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 256Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:Qs4gefGLINeoRQ++qe74bFUqdb1uRm90UJ0jF4Gx0iPqd8Th,iv:brsr1KURdd+UxjK8hArdxVyGeLfWkjjppxJ7AvtKxvE=,tag:H5PapOGBMp07fFW8U8mATg==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:p4sSZ5A+e0i6d5oFmoajiJg9qleRrwEBj6BcqF1Vdn1oNp0=,iv:geMgXAFeMxBjZgJKIkRZuYx5oa7BsynSArspnbEMC24=,tag:C5CLCD1Oe/LHlJJ7wB7xiA==,type:str]
        - ENC[AES256_GCM,data:8MtmL+oXsfx6lHZqNVV1gpnlaHTE6MtWQg==,iv:csHYUbf7Gt8hi2dgNycgsmWKVSIS5/edloC1SrK32zU=,tag:eE90EbiVvYkTXB/EW6f11Q==,type:str]
        - ENC[AES256_GCM,data:K+qmSe29qjyU64kf6RJoo/87ppqxO6nCX8vw7fljSk4IGRh6A9Tu4w==,iv:aee6rNwkHIFw+R7kpZXChSlHUov6QxDf9ONFrWwTBgk=,tag:DhSw3L6vXX3qTup/RjADvg==,type:str]
        - ENC[AES256_GCM,data:2OrjLhuK8kNeXMEx/A+PzOqNltzrVb0hRLVJSKU=,iv:qYwQHMq3CJ90O1LOJL/vKW0ysxYWTuUbWT30mS2qHqo=,tag:iwSiCX1OXn1frT7FoVCtUQ==,type:str]
        - ENC[AES256_GCM,data:W7X96Jk5ptiES+mHx74zW6F7LZbjLKfqim719v9b2qI0D8WYI1YGYcdihKqpCdg=,iv:V3DLWEHhO1eI3CagwBND2Bb6cFyFDERcsoGJCL11ZQE=,tag:Szodit0+qMZFPvrNeEgFAQ==,type:str]
        - ENC[AES256_GCM,data:z7bNBnuuSz/p2ft2SMDyvIo9we/U/Svb8VZipcBagETnd0zPhQ/3wIcQI/6fS99pdtutkKqI,iv:LL4pyzqE/WczDqhzXP8bJ9fRxwe89Qq/eyrxHES8eOs=,tag:Oonz8PilZkbm5aRP6XLsgQ==,type:str]
        - ENC[AES256_GCM,data:fL4d4c5FNDP0bBePIXZwLfnzLQSK26x7usP2m8ccMngBrxYbO9vU,iv:NbsaTY29tJemFjKTpgTo2KPebh1Jlil66WoK7RCB7L4=,tag:J71GI5RTT/SIo7el05s5QA==,type:str]
        - ENC[AES256_GCM,data:EjervU3ApoutzViquKA0WaCDWDREn7+fZ3/5SeX1LrRTH/QUgO1/XhDwEOY00g==,iv:Xgg+xOhaRojevuU6DPOxMvIrMu53hAHRWIEVJouhoD8=,tag:YCQAZHsqVFBkb5vKiI6NSQ==,type:str]
        - ENC[AES256_GCM,data:8LaT4HW8zf79p8fdSASzGa4H0Ka+/FZmS1gpxXPrA0jK9e5tIg==,iv:RXkSQk4b6qARaN860I+ax9J4NtZJV37s4mWEEjtCjPE=,tag:4KiBM92h3nDCB1hy79MLTA==,type:str]
        - ENC[AES256_GCM,data:eVeiWXtcw45KE2DXPDgGVGKzIHmfFTxVb6VhqIFCPi3723NdhdLo52YsERs=,iv:BhKfUCoTPRmdPEoZZwpwPn3fDFl9XanB+tFvHfuMZBY=,tag:Ffw9eTZRLHyS/eUHp2lbfw==,type:str]
        - ENC[AES256_GCM,data:v+VAH5m0t50kWlBytskAEfbPMkkEcZ+AEOofp3ClO+qrCeG30jEn1xYUu5xD3A==,iv:wUPT8mfwNUgtZAJ4xiWHzAl4r9nzKUFU0LaoJi2yi/M=,tag:mmocnhXZR69q9cgdvJ1qvw==,type:str]
        - ENC[AES256_GCM,data:Q495I03esPtg2q0yUspApP4HzPDR81/8pSaRvSb6hgsfgA8mgUsOekel+z7lfIAKSGMa3Ho=,iv:qe/vIyF4UCxTlbpEewNUKfBixafAmBj0DIryyzop9Ec=,tag:oYLX8k9OgtJbkAi59KFWDg==,type:str]
        - ENC[AES256_GCM,data:sQf6OhbS3GPv62NJ6V8TtmbSdT9M3pRDcOrHEXwF9aiItsFkHW9nGsXGKQL82izh,iv:+qJ9yJCd90taworI7S49Hxf1jwfeZxP2tX1LWImKHxQ=,tag:7EoJ2SAvUrxPHCOFBt2aNw==,type:str]
        - ENC[AES256_GCM,data:lTlY0+TSYu5G2s2kHi3DHx44TsNEJKy4a+nOz1vrbOvYZvCQs82UWgZG9qe9PNRb161sn8187w==,iv:B73/sC/IU3C7kPwWxXTo+vHPBwCkVdiXe360lGxG7Gs=,tag:z1M3OKQsRDBVn+1HMWXpYQ==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232,192.168.1.234
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.11
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.11
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        - dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 127.0.0.1
        - 1.1.1.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB5ZUNaQzFEQmZhUmNzQ3BW
            SU10UUwrMjBWeEhEa1o2VDVmVDQzNk5WRjBZCnVmYmdld0lQMVJFNmlHRm5YYlUx
            cnI3NjlrcXFCckwyNGZhMEpEb1pmSXcKLS0tIDltN2pDUDNiWGpIcCtER1QwcXBG
            SDJlUDEyVFYrRldtNktuTXVXR256UjgKKqnRvtu2QTBzsd6A7Eh1ThPIZ5EW4DfQ
            bwXE0CmWYgEaRKmKT37TWIEPbxHWCSISwDc3nJKXUQNdr3VzqLOjzw==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBlN2xRdkxNNVJsa25pNU9q
            MzJqVnlXTDNMaWJZc0doWlhMWWt3Z1FnYXk4Ck9ieWt2bFJWSG1UcXdSSk5iTzVT
            R2psYmNJOGsyK21rcWNiUHR2MTIrMGcKLS0tIHRKalBrUE1UVGtSOVFwRlFrVG9C
            cW9vUGp1UjZKcXByMldoTDZJY2dSSGcKxY5VCLoIvDUjnm8qKKEZ/7ksXv5V5jxC
            cHCM4x01Z1DkSu82O+8RWEFCmhct55kmFJ5XgJgz6B0P3CSPYQ5UZQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-07-20T12:03:00Z"
    mac: ENC[AES256_GCM,data:V2Tzz1wYpV5OVxqps5/aZuJZFcvTXs4qWKzdjjKQ2eRPMAR+XG9Dt6zZCLhT8GS0h0yL0vB+TJYsEsgl576af/tnvS7IiGiB7PQsA3nyGT5c7anwandiBeH+V3R7ChyhoYDWdnuD/7p8qqh1QPfD+DNRfIF5S6Uj78hlBCafTAs=,iv:8aiwzSpLVDRIvOU8fvleRQhE1dxltMfKAE+4u8w/LZk=,tag:csTxE4ZSuzYkFo7HmwwMEg==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash)$
    version: 3.10.2
