image:
    repository: pihole/pihole
    #tag: 2024.07.0
    pullPolicy: IfNotPresent
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:Zi2df7voYw452ZMFbj6NJPh4gQm4W8w=,iv:VbL8KwXyAhNxXuORNZNB2zAwwV1gHcbtBr+WeG+vca8=,tag:cOeu5xUZLZu3jmsYNI6xqw==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:UI7qQjx+NZpLfPFonAor3pTw/Xs3SxQ=,iv:Y2/Be2OSqpDQ5kcRylSuwb0msE1+RTRkACVlD7rGRiQ=,tag:NiUSUPvV910QjfdPnwJkuw==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-01
          hosts:
            - ENC[AES256_GCM,data:YNQxE1OxDJmXCipQ8jX8oGipD+JK1QE=,iv:ES4DPfAXT3EehszOphYYYSvWI93NfdvX/j08bMY73xc=,tag:1KxyrQDUw8k3FgKAeHxNMw==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 256Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:PJoAeZQNUJcAuPLHa8sIY+VsGnagTE02EBQ73wgYG45FjsTA,iv:ZATEX4j86GGMmVzDTSVRu/GhluKPpiglKDeCYfvFZK8=,tag:ZzOMdgQJfncd1TwpldsQEA==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:P/QLDd/PKdVa1o7D5E0Gm4tmNkRRwbUNNH+My9GQ3pvaM4Y=,iv:ExfgbUlcmZnFa+VrxQYnBLgVB53qxIN0Ep0SZ19WtPU=,tag:YibOwtJ+NKqevJKo65q0jA==,type:str]
        - ENC[AES256_GCM,data:2FR9X0ejjIFOqOZLL02NLyZ3H0JfDbKuaA==,iv:r0l4n5rC7k0T4CI1DghwFl7sXOQN2L8Q8TQ7E28jvrA=,tag:D+//uN2hJXxO+u1ge4544w==,type:str]
        - ENC[AES256_GCM,data:9yMZX571lfOmvA0UPY33csdZT3gviVkSWCgVvb0jtVbApjWyFa0NCQ==,iv:7gwRhW+o0rKnwBXT9Ndwkh3LxzIJeBfArrctn7WsAHs=,tag:hcbSVGYjfLYtXAweK4RGkg==,type:str]
        - ENC[AES256_GCM,data:GBxDPB56GGP/+ZemDxTV/V47C1oDLG+zDOrAf1o=,iv:U+XhQFy6y0xYVS7NY0VayuU2u1GL+2PN29Ho21iT3oQ=,tag:lXysi08DXDI3/tz+ShPcYg==,type:str]
        - ENC[AES256_GCM,data:HARrxYkhMqX8hGu0U7ow2aTkdsKfqNdHq2mA88tbRKur64oA5BNsXPG6vKEpybk=,iv:yEnZWX64px5jAdCf9XMiXmzxtCpoufwU4e+cpC9NSao=,tag:/qtTXqdjnYPc7oK5k9XODA==,type:str]
        - ENC[AES256_GCM,data:Sd+73KiRO4lBBkOlL07q9h273nuep7uHvD0IW2mDQZleGtUZ5x8v+ncqCVKBlZ0HtRM/KdrF,iv:Zq+9dnltEz8y32w4ZSiTUWJE5jqA+1u/97kIlUUQUPk=,tag:QJU1V10YAuMP4bOFJ71PJw==,type:str]
        - ENC[AES256_GCM,data:RSGBK+uAEE5g8ViOU1ZNcIj81WXW/d/kBkWXtJZnUJtQ88LUYXhF,iv:hM6SIB4OaV7gQU7zp/u9HquQkole89LjlMDNoENyDcM=,tag:KlKGpLxwroIVYvco1JBqXg==,type:str]
        - ENC[AES256_GCM,data:shXm7my2TNw7sAumHbn5PGVzQaMhXcU7HbAhV/6JHvOhsNJ8rcWRt5EV8FrIQw==,iv:wip11FeogfU2tG/SmBJ8wyCpYMzwAfdxqNRQ5AJlJ6w=,tag:zGyqvFZhbE7Ahvrll4UJXA==,type:str]
        - ENC[AES256_GCM,data:tyIR3P+oF9j9k9mq734cKT5W2y6vfx4exMLZMQDZ5kVgcHVyHQ==,iv:aXv5sZ6IvpoZ8SEP8QMWOkEkJ0Zmh0ujrVXndSMxxEA=,tag:hQVleY+M1GeSQckThNRAtw==,type:str]
        - ENC[AES256_GCM,data:q38Dcs64+wC+f/Cb1saqvWv+jQ9ld/PCg6B711FK5f1mmhUVeFxyGMHwYnQ=,iv:H7GDcEkmOySSgcZVKiKsnFH3Va6TBrKF9PaYB4bExEk=,tag:L5PMG2oew4efAtvEIfSVhA==,type:str]
        - ENC[AES256_GCM,data:putWsgp7myQcW5ee/QSwnalEmWPAMXap5JApHVXi9r4NS+jiJqrTgVah/Gw0Kg==,iv:a26BXqFbI8y2AONgNJXAnOv6R7TfqyLfTsZUdSImgd0=,tag:8ZNj9902/RtuOpHYWH0FBA==,type:str]
        - ENC[AES256_GCM,data:5WzJgTTYjWtPQbPIajMJ/TAXwW9LOzhB9U4ymHXRi6s7HcxE068oDsZoUgoJ7AuVtgry2cU=,iv:xfMxw0nuHZQGYrrA0C7t/7VouJleq5yIb9LkXxTXgc0=,tag:mIyI2c3jhC9a12xYn9LaHA==,type:str]
        - ENC[AES256_GCM,data:QcWqDxdYcvMfGyXPfZjrYAQRCdL5JbB1jgcwI9h/Ky+Xbj9rKVqz4BP3wIjObkbz,iv:0fueQBsLcIt1V6hyTb3YAyWP1veZHlg522yVksMxHkE=,tag:KcO39qRQm7eEDjZ8nYd7gg==,type:str]
        - ENC[AES256_GCM,data:6tu4r9SZf07ENn0wDip+TdOzkvgryzqTNG/Kh4RCHaXaoPm4SiiE4T9RlutCQ1/9OD2P6EgXpA==,iv:1TnxqgEjukIYuRJfmwbsH4CY2ScbYDCHUu8XbOTdLaE=,tag:srb37VSD7+I6YbG9ZWxn3w==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.11
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.11
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,E0:80:6B:37:56:83,Redmi-Note-11
        #- dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        #- dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,F0:27:2D:D7:41:97,Fire-Guest
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        - dhcp-host=net:youtubedns,8c:8c:aa:32:ce:7a,IONB000201752-LAN
        - dhcp-host=net:youtubedns,4e:80:5d:ae:a9:dd,IONB000201752-WLAN
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 127.0.0.1
        - 1.1.1.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSAwaDVweDhtcmVGY1AxcTlj
            K3dDSmJ4emlndUQzOXA1dTFXQWg2ZVhYdld3ClVhRGtaUFFCYkRNU0ErU0swc0FZ
            WkJoZ1NIU1BGNjdSR0U4MzFDZ3hhWlUKLS0tIHBjNE9EdlhzM1hWYWErbzQ0TE9x
            TjVGdUhjL0lOMnpHTFptcnhIbm8vaFEKghBjdOsFOT30+IMQVQIXk36MF60/q0qa
            JoJ/ToMX1BJ8/GBT9jJzH64sWCJwa+1BORW1v1zC7Whw95ZNji0Zyg==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBmMERwYXRrRTdHb1FWeEU1
            Z1R6Uzk0bHRwa1ZYSzlPekZsTDdlak92akZBCno5TU95bmNnK3ZKZkRBSGdmTnhZ
            WHVyd2hoN3V3T3h0NitpWFMzYmRPb2cKLS0tIC9BU0YyYlZrdm8xQldjaXp6OFln
            S3hxTTNKZXdHKytiQ0VrNW1IU0c2UDQKCoa3QBGWzUNlfgionj1jgWDDEx3hfN3b
            ZE1H6doOwdkf/Q7QXrLEgncKEGY7LcyZH+5tozRBPyvDGwPBX6m8xQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-09-22T07:27:55Z"
    mac: ENC[AES256_GCM,data:6caSchNfZ4pd87vzU+osw6apvBKVFk9+gaKk2DAi6R9hhj3bLcPQrWZUOpXzgKIZ6bi3KdmXcn1l6IFkx+haNo/NhxveNw0ageJIMo12WiHew0dWbgZd0oGtMspQli9tARLucrL2JMV2YJf3GlMSolCfUQ+banJv0d2t3QqK5GQ=,iv:eK9c0yYVDbj4ZTbjfT/dI4sUahAjs/J3WWbufj0Nics=,tag:zeu122ec5wz+Bfm1ohvLsQ==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash)$
    version: 3.10.2
