image:
    repository: ghcr.io/pi-hole/pihole
    tag: 2025.11.0
    pullPolicy: IfNotPresent
revisionHistoryLimit: 2
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:/mNN4WopgtlZuTaFet3MOQlr8Ir14/8XKy5Raw==,iv:V3yhzVZEdCdWizQkzkHpfob7G+Y0BWu3Jwof7ZXyaLQ=,tag:OolLKvLFWdKDKYJwrpHo4Q==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:1OUgDTib6GNjGvUfgvFlDznF5q9eDkQ7rCj48g==,iv:HaAfsmA0q46AxyljC55xCM0Fprqh84lRdLsrhymdN6I=,tag:iwT4pkhQN9h2tSCQUR3wow==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-02
          hosts:
            - ENC[AES256_GCM,data:gBDbWDFu8IsyFR+j1wM1OdKBSSBglpdkiMw0Lw==,iv:49LEdJcUfUPp/Opyq1dCPCVp2pvWwZ6BmwC6Mb5N5fM=,tag:Cd/mzkgZOzCy5ejWYoQqVg==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: web239, websecure239
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 1024Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain_name: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:2Dhy/teoAQxxj/QNquDaOyTxnZps29YB/WjHI7blF4adOpCL,iv:SMgcE/2e8b/KIk72SV3jvNaf2lQ/cNY19CsV6xhouDo=,tag:mNmcsqObSh7Q/44pR3Amxg==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:eLz2DFYS0wlJhj+lgQr2hdYSJg0uhAGiJWJQuDYSfe2PYXk=,iv:l5+Ikp9jtNS+5gMaJTUa6/ntKuUjsDIxImdOV44rgwI=,tag:/w255Oz7ubcmSEOQ9hgEqw==,type:str]
        - ENC[AES256_GCM,data:1ivii2m3jf1VtsYSZTJp0v6HqA+Iwj3HOA==,iv:758g2Y+a/ICHsO/g3g8mt9oXjbD1pVNypQc8mRY0I9o=,tag:DXuXkgJssO8imCAYSZCRXA==,type:str]
        - ENC[AES256_GCM,data:4LCSbHDBa8Oe7Z5jET29z1Vz42eioiipcC+0ZWXUFoVPttQ/XGlhhw==,iv:Nd8Hc2aE/2Zi3CbqrCOH0y2SgHB6X/CnPbHn3+OgudQ=,tag:4tJM3NiZ2h+apaSGo/Yydg==,type:str]
        - ENC[AES256_GCM,data:FXeNUYw27jC9YGSQh4LlsNdxQNTBJB9uPaojpco=,iv:fgryCAaN4/9jeCD0pjzlbG99dUD6F/RnD3YCFRkojVg=,tag:wScMoiMsjmUcYwDv6Bg85w==,type:str]
        - ENC[AES256_GCM,data:aEewKdnjj9vDGdjX0WXYPg38hjzmWN7Gpl9ftYP4GRMryftoZoTMVJZpcy/P,iv:ZlPO+br3lyY6CMwU6MbMLLAxyl56ZHj3lXW1XPeMZ30=,tag:1Coi1gAWAY1PlYc4Z6DRWA==,type:str]
        - ENC[AES256_GCM,data:00Qzs+ofWa2h25P9uJkMJs4omoqvMBAdHaiQOlM5jnjgLw==,iv:0gKfQtjDnBgDPijTHnbLp4xAi2yvaIG3KwU11GaHykM=,tag:pmOMBRyEJ2K6FRREcaXfOw==,type:str]
        - ENC[AES256_GCM,data:K5VJEPyBSHzSS+aCxmY/KCzfuUmVY5iOKpOrhjd5CvIZJonjbxpsX2xz/ClmukA=,iv:yId98a9JTM9YZY2wttJ/4FEOiyZ3f5qkRchKjuQlci0=,tag:1/vwObW7tb7P9QCyPk3nVg==,type:str]
        - ENC[AES256_GCM,data:/KmNg0sABHyxn4+ARWGMISTYC+9zcgaPTVBDOzTiiVtL//5UOeEPFot+SxrmGDM48yRDKnnL,iv:d6s3TG8laQ+5yR+VJ3D/uZIC1wId1w1InwaMBTH/904=,tag:7IyF14MbYOOqbj83XPUssg==,type:str]
        - ENC[AES256_GCM,data:wqDNSYk5ZeqiNniJh7rjXEdyLLaKPKZIgtkj3H/wxhOfsFTLOtuR,iv:7FyGL0DHYy1EnCznT2DL8G+QgLrMErgYT8SAK7rCFeg=,tag:QFJgLV9nbjrRJuKzUglgQA==,type:str]
        - ENC[AES256_GCM,data:1NTCqjfgjXXAx+JPw6lTFJnkoYS+mjSmmwTR3JxNtLUN68JevyE4hs18bsSpEQ==,iv:3MNTrUOmgUmxTmPA/55PyKgFEDx79fRGJSR25zpZhiM=,tag:6W28JcMsM0xEdrZsBcHvrw==,type:str]
        - ENC[AES256_GCM,data:5CSAxgsc+W2xIZNQQIHYehj60UqS18lVdj38X91H1GYL/xpH5g==,iv:JX6g/dKDVGsDC5lp24W+hFU5FJgPw0m4tRxrmnV/xII=,tag:ZH2WVkuIuVpxyjdB+K+FRQ==,type:str]
        - ENC[AES256_GCM,data:XUJMZWqGBzJ7yU+TIfMDSu6xz88+3mx3d9/bC9H/pyyf9Wf3Vr5NqxAXCRs=,iv:UBt2Jz1EvWoDTcqGc0yc7WjNIZjk9j3YN7soHtuR74o=,tag:fai/rm+EpbY2piXhwT4mHg==,type:str]
        - ENC[AES256_GCM,data:15ptHAnB5zDd0kMKTVX7b6pyIMC2sm23fIM6n1hKaDQrifOis3Tx5r7kePtGmA==,iv:dHdI6olrNv5TnHgjhGSKK325kpr/5U7CkMIf6lSFdYc=,tag:/BO+E+jOSdC8gNecQ332bQ==,type:str]
        - ENC[AES256_GCM,data:xoLIzLeG+OwNO/1b0dCOuOJOqSVgjKL6RFISUqBArp/6yuU9PpjqF2Qg3QtAmTvyR98a+48=,iv:II1kUj89eusPT/CpKEUhQPrYyUkaInPNAMGYlNyuOwg=,tag:eztreJc8o+3aDjblSyT73w==,type:str]
        - ENC[AES256_GCM,data:oWLdHBgBJ4WGxBOZ/854EOjkF89z4ZRE/fpNmqt9iFmjBnyLlIVpDO5W75AUZH/I,iv:nPY6uOiqS6APHK360LztRDeCz39amlwa2KTsfxkgGU8=,tag:3ez7jIeXiBdcxb/dSxePdg==,type:str]
        - ENC[AES256_GCM,data:M+84kmRJR8QEi1Y8AidLP7iZGQGJAirPO9UmufNQX1uI/HKnnseFOa+h9wMs1ZPObR/6xGCIXA==,iv:5I5ElrSE4XFJ5kR+qB4GS3YxT7l6HGCZYHMRl/fvDes=,tag:6m28fJCNoMua7/RjfAfYFg==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.45
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.45
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,E0:80:6B:37:56:83,Redmi-Note-11
        - dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        - dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,F0:27:2D:D7:41:97,Fire-Guest
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        - dhcp-host=net:youtubedns,8c:8c:aa:32:ce:7a,IONB000201752-LAN
        - dhcp-host=net:youtubedns,4e:80:5d:ae:a9:dd,IONB000201752-WLAN
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 127.0.0.1
        - 1.1.1.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
    nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
                - matchExpressions:
                    - key: node-role.kubernetes.io/control-plane
                      operator: Exists
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBEUVdRUjVNeTVKbG5kUEsv
            c0JCNVA4TmxlcmxIL1l4bFptTy9zNjViYkdZCnlCdW85cFJ3ZDFSb2FCN2VLQ0No
            VjhHYmQxYlcyRnFBVWJkZWNoblFMMkkKLS0tIEl1UmNGbW5jRmIxOVo4NlVFVkxS
            QTErWGJMUUNCUTNYd3ZvZDkzTjBVa3cKkbno+KgqnMUuhOOfReaIcOpdoNPPr4jJ
            kKns2eZzs6Di1FPkbJmPdvyiKe2S18RuZJPI5rzZRLaP+VqSvTQcNA==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBiUFRaQWRQTmx1NWhvN1o2
            ajFld3Rqcm5EajZGMllvVTVBbnpJOThLcDJNCnByL2QrUGIxZ1VyQTVwak1nNlR6
            Q3VJcHBac3NpSGZZK2NTMjZCY0lad28KLS0tIE5zd3MwNElrM3FMdndueG5KOEJq
            YjBtTnRkYWdtTlU0NVF2UE9DWWZRREUKTmxyGgERBzOHOFldv6EJ4/oJm4pwH2d4
            iJEKIVzwCYkXL+Q19+O0vCYWzB05kPQp06+0sooIAJBVbOlVcsMaQg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-12-01T07:32:59Z"
    mac: ENC[AES256_GCM,data:NOFK/8qXQpwtnywEk7hJ6p1gwTRM8UR8215AN2oOXdsfy1J4FGsKV39HXOYiddcoY463arvWcXVDL4yshVV/F6eU89OJuD4Yo66c0TTOO+zOTeo1TiaZhnVv99V8dPX0jaULxoNowbAYgcSv4Lg5IEXFOA5dAJqZKpLcDbokQWU=,iv:OxXLGMANlSQF78lUTGaSy8JapTNAHvMNn3fKCvRb9IY=,tag:wp3jonqFvZKaRMV18gpbpg==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash|^ldap|.*match)$
    version: 3.11.0
