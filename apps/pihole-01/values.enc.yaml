image:
    repository: pihole/pihole
    #tag: 2024.07.0
    pullPolicy: IfNotPresent
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:YRdpjbwNT2kzE/Kp5bPmPqyDZBZKMQU=,iv:WUYt6KUWGxY1sBJEjbID8jATlzJAd+kcPEBdSw5qSFM=,tag:F+uhRolxv1g9TFHHoTS5CQ==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:kHIQ7E7IV7fJPljndN04jJ9NEhMuNGA=,iv:BSlzmoQ4OwH8RlaGO6OIcGQm03VLkhGA86Blj65buqc=,tag:9kEuEA7S7nYPbHebXxOF/A==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-01
          hosts:
            - ENC[AES256_GCM,data:BQGo3iXZGFCKEeMOTWhCb20MLD9LjWI=,iv:cP74EVtW+vwnX66NapnHs8lyrrLt+hubEGDlLyu9V+U=,tag:Zpo+PQ8GLzR4T44ujOutJA==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 256Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:FEV52RXu/k6L5mBf8WuGs797ih/1sExkBZN+lnFaeSuGCNRw,iv:V7n3S8Sww96vZM3UFPy2P3qdvkdtrJSbzmz1BeDm3Tg=,tag:w/wNvlZj8UrjMovvaks/Dg==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:WlKbgrRKyO49tV8F61SD+rECcsQoiY0f9BvL94QyHJRykuY=,iv:8EGfM5/cHW13+mR0tvk+jrL+JuoHhS1Xnlm32D3Z8nE=,tag:49C4kfu5agr7YmpZqqPD9A==,type:str]
        - ENC[AES256_GCM,data:Z2VAUZqTtPJDDu+G20VjQrUFlMQxUURIjg==,iv:QrIHa0kuHSK3fqwvwXInF5v/y3Hz/5J4+FZA51o7rfc=,tag:griSDmtltKBjaIAUdUJc2A==,type:str]
        - ENC[AES256_GCM,data:lHQ/BclyNPgqlcZ3rUcVqmJSkJN2hFkVVP2XrrYygRfkI94KarpVxw==,iv:2WGub7SuMyX3fOPjK4mJyVAsP0QSw307mo+cNDSS12k=,tag:bHQDorm1VT5SJxNKNcSZUA==,type:str]
        - ENC[AES256_GCM,data:necPTJ0+3S5QEpRvQn2cVpdlH4yjPkiVC2zxTtc=,iv:Wv0IJDCW72RksWKtQzVXPvfg9MmxmGJlWjYNC8Oc8ys=,tag:GxGNY7mDUNdJz8tpUt9AQg==,type:str]
        - ENC[AES256_GCM,data:E4x3j+2WXPGOYpr2PcnZpPyfP621gSlTmM3tk9V7etX7DC+mHcLoFJWQvHIpx1I=,iv:SuNOiKJmd6WzQN1+D7+vwpbOMgitonCkc7w3okZlGjk=,tag:Fu8E8DPoR/iJk6imvUsvqw==,type:str]
        - ENC[AES256_GCM,data:PhS5QIq30ID+Tf7xRjZof1scsLh2wiKcfG4k2/wgIYOIdCwxrjr1iHkP+P7fNkr/V7sXJ5uV,iv:vfc+Un0m07j70upGMssqmgynC1CdVvyx0zz+GTX4vLs=,tag:RZOPHOLjKGZ2iiigIU4pIw==,type:str]
        - ENC[AES256_GCM,data:Tan+sGr5jZ1QqSuSQkJ6qtlxRL/XDnuK5QsMBItBQmouNK3F2kUP,iv:lLxTO1tIDfOMUIVNSTYdl3ls1zl2VW71Mjwc2Ee8bNg=,tag:m0MmdZMdyAT4i3Bm/So+dQ==,type:str]
        - ENC[AES256_GCM,data:tZGqeC1hRB+qkWKeyBoEBZDkXA53SqOqy5p1fQCSGpn1oGNm3+f68NNVR83Mng==,iv:lqQLKt+wQ2Lt8nkmb5RZk+F4wDammkZTJ06zqWkbGDY=,tag:ZB6tAZuod90IIzuNX5b61g==,type:str]
        - ENC[AES256_GCM,data:xlHzhbr9zdh4YJlkZ5sESKWkHZLxDk+eaga7+QAREc1XOlYQmQ==,iv:bWGlicCU58AAnGWMy8Ij299MLX0KVa+Yf+TFdSeOu6Y=,tag:DisoDDWZh3dgrDxmWMB4qQ==,type:str]
        - ENC[AES256_GCM,data:Y50Kt1esfVMD4Vww6yTSYYRVekXVUZ1oVncN3RqrZaJdvPAHyat0K754lwo=,iv:3PzTCf7lYdFpwh2d2lgDzR202sUrByg6iY4oka8ZMdY=,tag:aBEPHJ9W7M+wSZfeSLShRw==,type:str]
        - ENC[AES256_GCM,data:WxAAKcvhxeBAewpyve0O+mYSc+1aKD1QvFR64GpRT1EbNxbh+2P+G+XjCadzZg==,iv:cAPx5K72DnXN1k9FUQipNUIcd4dYmygqbhhBJYtCq70=,tag:lUju9Lt6YtxAhLgMTnjHDg==,type:str]
        - ENC[AES256_GCM,data:EX63Fif3BsU0kprMkpTjhDZfaVZy3ldE8Ma8kUVk2sagjQuZf/WaE0zYnG5zj38YTL1WMa4=,iv:2UzVX3WXPZZQXLFqcC15zlfOR5wpgyxt58JG0eQ1pk0=,tag:KbGTblD2+XHHTZekR0hqmQ==,type:str]
        - ENC[AES256_GCM,data:iuitksfT5P+hi16GbSD0tFu3vAXK0MAfJkrxvg8ZR2eW8PWtG9G4noBmzuZn1gY8,iv:qIKgXfRYI3uaQ+Xun94rm9u8DGmdbHyd1jrONUWKniY=,tag:6mkx9WFKwd+jH+Xb3YX2Qg==,type:str]
        - ENC[AES256_GCM,data:ot6UXN9OlAVHslZgAAdorWApolpOY/hFMQ0zt4qLnRgOBui9Cg5AW3EWg6yP0f9K2TnBy/LZ5w==,iv:f5j6qJSTsKbl54JhzNwVQlr7TEVr+8Wh361vawcY2qo=,tag:JoXNBI7o++9oEF5iFcfKAQ==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.11
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.11
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,E0:80:6B:37:56:83,Redmi-Note-11
        - dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        - dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 127.0.0.1
        - 1.1.1.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBDOXEyci9xQldXcENSN3pl
            a0Vzd1U3b0Jnek5LemRsVkk3NE9YV3RKNkhZCjlCSThoeUNya292T29HcFNVMTB2
            eE50TEMxTkt0SnM2UHZpbysvUEZoV2sKLS0tIFYvZUhyK01GcXJkM3VwUHRWVE5K
            WXNLVnQxdm1KNnJwb2MxUFBzaXFhUnMK6rNzmHrugCZppI+QAiaws3X8HwcWUepL
            IYZzrE4ix5okBXxsALF0KgFhz5+nzts++9zVzR8NbjLZQH77hDstVA==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBqZlM1cXY4bGtZMFdnaXk2
            ZlFPcnlwUEkyR0dhMVU4NTZKZWxKMVF4ZmhBCkxaUzAxbkxqaHlZVjVCU1YyK0cy
            b3o3Wnhyd3I2ZnZpZDlKRkd1ZkRnZFUKLS0tIG1CQWp3cGhaTFNEZDFLbXhSbnRj
            bHk0TGRkTWxGRDBYWXFBaFhZUUVROTQK5vIDKxZZH9Bhn4iNk7qKuhPVQjgxIVVp
            WRHoZpl5mulStGXSqrYDZ9jmwYwCpOT+mPZS/Z/lPSmGO71OJ9B2LA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-08-02T21:17:58Z"
    mac: ENC[AES256_GCM,data:b8vgu1ST7QvVVAbVg19Fw277u7YM8avJcAb5ZvhMlBtHtei/HTxOC1WOo86kHh62QUYAeuuoGlatYcYjvv5GC4IVVKTULaJ3i4mTllCxvzBtwnrOhH93/q19hjFXFkMyisnHurhJ48ecE68H+TiGBjGGrH3jAg3BV3b1545DN14=,iv:mWRrUblaZBj02vNaMK2TfdQPFgUERc9meqTOE+8zAz8=,tag:QP+I3pul8mDrRMuvHEagnA==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash)$
    version: 3.10.2
