image:
    repository: ghcr.io/pi-hole/pihole
    tag: 2025.11.0
    pullPolicy: IfNotPresent
revisionHistoryLimit: 2
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:i1e8i/1XqDD/o8KYYvhHUPHhoLmaYmACb7h8CQ==,iv:18x5ZT6YNWvx1ELCXLGDrMXbb71JsZosjk8s/aeTAu8=,tag:qdNMk0mfGVeZXXCnX6YeAw==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:tJJBpEns3lb8/iQ7OKHztKjYeEw1AqwFWjUihg==,iv:KPeU/BMyulEEEaThwsI3sZSRubdACOTKDP1ulHL7Yqg=,tag:x15A1IuMYz+Cc0n+U6a5Vg==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-02
          hosts:
            - ENC[AES256_GCM,data:RNGd9aCkVNh1QPs6WoW4rCDuoNVKIxAgRrBGSw==,iv:KqlGbXvTNyl7y+s/o9iJGTFBtvNfo9LZoio1QaYiijA=,tag:+qBvGz4X0rTAWVu1DoVshQ==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: web239, websecure239
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 1024Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain_name: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:w79hrd19IAMy4gclzWbfBvb4cqul0wTaUJ7MbBIwXx6zQ4KQ,iv:DsvXW12df6EDk3MRqrdOiIwIzM2tNQQAiJ9h1sT2Zec=,tag:KtJiZrJlYDDabxRF/+odoA==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:wMKKWp5ZUt7CSUIieuye8TpgHPNUCEsj7eTot7t5/Poo5YM=,iv:kuPAoUEeEjLSDhNACvEtwo8AxgQbEB7WHbJWjsqmx4A=,tag:CNsCQZTAwLTnwNhBSxeKMQ==,type:str]
        - ENC[AES256_GCM,data:uyURgkytSdXpf0+7Zl8ajs/f/57zH8jzGw==,iv:1L9fZeyNHg0pjle1mYRwwgWtn0A1eYM28AaKOmwM4oo=,tag:N59IBTHAo/KnWeeDO1DDQA==,type:str]
        - ENC[AES256_GCM,data:Vre/UpIQMmj6SvAybLCu0tGOca97Ayw+2UIhm8M2fd71A/ke8hFcfg==,iv:EaDeqKu98hrOc02oZYqCo/1zdDnxsbOpap+Upgz+KKA=,tag:NQprIBJ1Xb8lBupaVu8Zbg==,type:str]
        - ENC[AES256_GCM,data:aWvT6MkvGd8yD4vD0WVKjc2iQ0i/ia7IOLZK3ok=,iv:rSK11UBJ6jfm9RqgurxDJwn7YVmgA7guf/N4jdQsGJE=,tag:XMy148qhYcm6PNVa+5fPLw==,type:str]
        - ENC[AES256_GCM,data:CQBZCNLfO9Zzzj8w3MwE8aG1vmRDUXBgSuiUO3d0FbJ9LbOjUDObosDLdv4f,iv:nz3wSqM3nNtKLk/qxcXCgbDhOKysK3bccUonen46hZ4=,tag:/H+/k0YGcsc7gMCvVkJjUg==,type:str]
        - ENC[AES256_GCM,data:LM1Gr6EPWd+vDe1F7z2hUPGH0SQuH/4AtbBxEmxyDB2qlA==,iv:q1fZRyCbOBXIz1TesF86vuG/e84k5k5QmObZx9getig=,tag:btaZweAa98CG25cZ4dHTqQ==,type:str]
        - ENC[AES256_GCM,data:aoIaHqjGB8+ZMreJAL1ZArF8oHWLTyYRSlSqGjZUmkqBsr1znR0NnjOhOijXstA=,iv:jK83tCKtt2wWQtov0bWZjYV/mfBFyi/AAROai7nvv60=,tag:XH+x0xWFTe/3Kdi5+WUSNQ==,type:str]
        - ENC[AES256_GCM,data:Ku9Hg+wW5Eo6pY2T3cll4y2LCZ7+YX/CDP+sQoThT1gmmHQI+eq8Q68JunKoto3ZZUaFTREG,iv:XQYhPbZokEyC9x4uChjYHaYbMd01tUpSNpePqFBVNIg=,tag:kBrd4UDJib4qgSOaC2YjlA==,type:str]
        - ENC[AES256_GCM,data:dNembHZTVJBVz3vQsw9bERXOZcqAHiKJdpCEuOWzUpb9xooE9mYy,iv:8PreM7PE0XkO1Rw6k+nyEDAbpRqUNxsahNU1cKBvsbw=,tag:68lALUT64HCzdz/MvFuyzw==,type:str]
        - ENC[AES256_GCM,data:bhQ4DnigsqERiPWUlb25BSM100hW2mzjJPLzXeNXrBcD0uc/GZbfmQ/gC9uMog==,iv:M9qa7Pry7i1YOa1Esl69EwAqWPAimHPL7AK0apkZrJo=,tag:H94i1bORH2M40StHOxE/og==,type:str]
        - ENC[AES256_GCM,data:gkrMsc4IGOg2K499n1IlKVgfmpgngrklE4urUsrBKB8hHLtQ1w==,iv:iCgqcu8p8DDlagDcpIEsrn3xPF+B1iXQfS6NyGuYSac=,tag:ug2aQVZUX3swyImU0QZv4Q==,type:str]
        - ENC[AES256_GCM,data:yNpowzk2jGM2R224dVGZjiSQ5ajAuTDpqWoAN7je1qkZDUPMWmwIFYEVA8w=,iv:KdFL5bqrg3Y5HrFe8IDZWpP5zE31I0P4tMgAZ1eoY94=,tag:H1H1t9dtc2KyMD2xx1yZMA==,type:str]
        - ENC[AES256_GCM,data:/IzwzlSLITdQLOWrKjY+8vDCjeYvvO0fYODi5kyK5U+eHNZfZnqaOT78FluSeg==,iv:F/IUV8aatUHVGeIQD6fbSnlV/zGj2XDPYU02yftMHIA=,tag:qy98wqniixUK/Gv5zleJfg==,type:str]
        - ENC[AES256_GCM,data:Pj+YdbOrtxZx+zPhu796lbe+K5dvJawpKqdRJ4K4c3Bz3OqgsS1xmhzSMWxrFlgnLBXu1Rs=,iv:sx/T8UzclejyFMFOPUCutlwDbkGkeg3somQF97sXXqA=,tag:bWItNOJjaRAhYfFDwdbj8w==,type:str]
        - ENC[AES256_GCM,data:iivr2itnHa3+rLtnJEj3o7XSrYOpqJ3KJQn1ayWVKUevawl8tgTmPkNZvca5l9WJ,iv:OAQqqV/8JBYmKj3M5+oBmD0JHKW8S3QBMGiV1KOrDOA=,tag:hUE8/lEu9uaKONIPDTYJYw==,type:str]
        - ENC[AES256_GCM,data:6dAuvJCwxsPwZVJwYlbrybO1XTRCxGBwGjh+4mpnym+WfzFpcEzgIOSijGW81+vlH5ck9+qBJA==,iv:pZiFW0NTaI4PVsDvQ+caCH2GX79UVEJYpIv/MW292mY=,tag:LURtMBkWjC8MHrXjezpIug==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.45
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.45
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,E0:80:6B:37:56:83,Redmi-Note-11
        - dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        - dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,F0:27:2D:D7:41:97,Fire-Guest
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        - dhcp-host=net:youtubedns,8c:8c:aa:32:ce:7a,IONB000201752-LAN
        - dhcp-host=net:youtubedns,4e:80:5d:ae:a9:dd,IONB000201752-WLAN
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 1.1.1.1
        - 127.0.0.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
    nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
                - matchExpressions:
                    - key: node-role.kubernetes.io/control-plane
                      operator: Exists
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBZNmZQcWVOV0tqZVdaZzZ4
            UHRYTGRLKzJzZFZZVFhZS1BzV2tHVzlnSjF3Cjl0SnhkeURmalVzQ1RWNGN1VWU2
            TWc2KzRNc1UxZUlkQkhHMVByTXluUEUKLS0tIGx2c2ZZRUN6TDJCbVhlc3p5SFkz
            YkE4WTZKcHJjelZhQkZIOXpNNGN2QlkKEy74+bXzDi7F/yqyLncOyjw9+4s2ja4G
            sa2vL+8/tIVDsTAQ3gt9Qz/plr6QdU/qs8HGHff5hg5UGZM//XOEtQ==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBodFlzTWZmSGR2REUyeE5j
            WjM4Y2E2K3lIWGVLRWp3aFJDUjZlVXo2blNjCjdYNjB0aWo1T1RjdVUwbVRjYWM3
            OWJOU0lDK1JxN3FHVTFNQ2RFWVNYQzgKLS0tIDJMWmlmOVVQam5vdXlEWmJVK0sr
            TWJYblJydnZ0WDhlWVFKVVprVWlaWjAK9/fLrXvkuCadZJi3rafm9OCxczL+/ndk
            b6gzeP1pG8fpf/489K4xqsy+Bc/8fLV3hbvIAGhxbHbCElVpZlXRLA==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-12-01T07:50:51Z"
    mac: ENC[AES256_GCM,data:iHQ57+lUPBxCkzx9gJSWy+kQy9ozDQ9lexS6JTO99Rn5v902M5jXPVbP2jjIIzeYs7qhmdEuCjk2tZmnTtl3fR3hG7l0MKtsyKt4TjkywetRllkkI0KimB0Rco8w/XR7xEAE2uWwh48Gm10xioeU80Rnugyh2upVq6Jq2+L2wEk=,iv:yQqL1vpn3/UcFFAGEH+GNnNucC4QF3tsKryqVMpLJ0U=,tag:YITHIbT5bzzBwEwCwGt0GA==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash|^ldap|.*match)$
    version: 3.11.0
