image:
    repository: ghcr.io/pi-hole/pihole
    tag: 2025.11.0
    pullPolicy: IfNotPresent
revisionHistoryLimit: 2
serviceDns:
    mixedService: true
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    # type LoadBalancer with externalTrafficPolicy Local
    # requires 192.168.1.232 on the same node as the pod
    type: LoadBalancer
    #externalTrafficPolicy: Cluster
    #type: ClusterIP
serviceDhcp:
    annotations:
        lbipam.cilium.io/ips: 192.168.1.232
        lbipam.cilium.io/sharing-key: piholednsdhcp
    type: LoadBalancer
virtualHost: ENC[AES256_GCM,data:uoQzzbNbAInoaHZYEalJ/yzwyXks5veFZzkJ7A==,iv:o6xruMYRTMGWwOjdIhL+N4LFEfENy6E4InKwhPx88KI=,tag:q2XjrTuQ7qK1dR/mJ/hwZw==,type:str]
ingress:
    enabled: true
    ingressClassName: traefik
    hosts:
        - ENC[AES256_GCM,data:EkZXmQyK4YJqk5lAtus36TZpCndSkXO4MenLnQ==,iv:B1dzlEPw0ZnTfuUsrL+eD7XLlIEH6UYZjlsfvpSVPTc=,tag:oC4q7+Zu2hN9pcc2ss7SBQ==,type:str]
    tls:
        - secretName: wildcard-cloudflare-production-02
          hosts:
            - ENC[AES256_GCM,data:zQe2CAvuzbg0h7ehVl/MSJTGqtW3pSs2gduwXg==,iv:c4Qx858en4hMiNkpI/7vWkSwE+hvd0EAlVlG7hzEXCc=,tag:liDI+aHJzkPHdUdxp3TRlw==,type:str]
    annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: web239, websecure239
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.middlewares: authelia-forwardauth-authelia@kubernetescrd, traefik-root-to-admin@kubernetescrd
resources:
    limits:
        cpu: 1000m
        memory: 1024Mi
    requests:
        cpu: 100m
        memory: 128Mi
extraEnvVars:
    TZ: Europe/Berlin
    #FTLCONF_LOCAL_IPV4: 192.168.1.232
    #FTLCONF_dns_dnssec: true
    FTLCONF_dns_bogusPriv: true
    FTLCONF_dns_domainNeeded: true
    FTLCONF_dhcp_start: 192.168.1.50
    FTLCONF_dhcp_end: 192.168.1.200
    FTLCONF_dhcp_router: 192.168.1.1
    FTLCONF_dhcp_leaseTime: 12d
    FTLCONF_dns_domain_name: neese-web.de
    FTLCONF_dhcp_rapidCommit: true
    FTLCONF_webserver_interface_boxed: false
    #FTLCONF_MOZILLA_CANARY: true
    #FTLCONF_BLOCK_ICLOUD_PR: true
DNS1: 127.0.0.1:5053
# Not required because secured via authelia oidc
admin:
    enabled: false
doh:
    enabled: true
    pullPolicy: IfNotPresent
    envVars:
        TUNNEL_DNS_UPSTREAM: ENC[AES256_GCM,data:w49F7slUml8L/QHbGOgz9HOUiQslYSkMBvqb7c6OIW33cRzR,iv:7Ow4qNCqrijcDdsniNpkpXTYtVQyrKp0+0NHHWFZvLE=,tag:3pFJgOx/SNBo6hcK1MpdTg==,type:str]
dnsmasq:
    # Contains internal wildcard domains:
    # - address=/.example.com/192.168.1.45
    # - 'address=/.example.com/::'
    # - address=/.k8s.example.com/192.168.1.231
    # - 'address=/.k8s.example.com/::'
    customDnsEntries:
        - ENC[AES256_GCM,data:bys5A88XmNd2mrOiDLkVPjMG7e4+Aux8oNn8P2lOIegcU8M=,iv:qsWCiJqM76a2ADZcEzpxzTmyb0c8vDpi8yUwAO3nn/0=,tag:aHJ4Kn33fE4GhW0+fjgx7Q==,type:str]
        - ENC[AES256_GCM,data:OOSwx6A6Tr2WnWknpDMBNF7L0bOrvLYOqQ==,iv:nV7a7YyBEdUm1Ueh8NMDOKSZ5CUIAYoeG/sLx9FUVlc=,tag:lQ1cc7AgMp4QpnPadlb+ZA==,type:str]
        - ENC[AES256_GCM,data:2rresSF9Cmmn6DR4IZ7AYmtsyIiVsqK7jxrU/ij0ddruGiFJaKCcCw==,iv:Cw3KrU9UY4x3p52DhDFSREQZFgNg80FxD8pbpoIGw5o=,tag:BRqT63O36SUOofoah/ML4A==,type:str]
        - ENC[AES256_GCM,data:Wqr+RKX4Nxv8BxP4YNtZRLxIHgkF0hWiV0AtpFw=,iv:6osDo6Gk7saLEZN8RtLCQ96Bx6jihzXJllJ2ySGhcI4=,tag:LMqBHvTAIERDanSrbdrGew==,type:str]
        - ENC[AES256_GCM,data:w9yUne1XQZgduj+8nkHvQKWZXxduzS8vd2GJ6TfBqPTijas/G7kWYK8E3TLj,iv:PcyMbuCmWYSVkIQCVaDL7i1To0e4DwWP22vPQ5h6xTs=,tag:3EViLz0KA06tQmcgXokRkg==,type:str]
        - ENC[AES256_GCM,data:gwoLRRbDaFooWYroiSn9JCzeebdv9l/sgmidYbshdiNW6A==,iv:kGmiNlHMT8rr5lZ3+xwR6Q2Sxe3OMk5i/9lJx9FZAHQ=,tag:2oh58Rxkgl1iEeu64K83gw==,type:str]
        - ENC[AES256_GCM,data:qx9pxEdsEMUolNF4rsQqZ79n/7a8Ht3/5qFvYtUy6HEaRyX4Tr6b2SZ4B3CceRQ=,iv:SKUYskfwNag9KArONmIAkN5FLOwFWX939wbgXlWePRk=,tag:RkIvP+l3EgsX9wRNGNOf9A==,type:str]
        - ENC[AES256_GCM,data:nWrC+7+eHFkPsYI8MjRJcuNA8auKQLhnUyS1+pUMRla3PO4n1oujICIsxFk9NTTWCSrgMgr/,iv:PYZruynSJYXV9Gdqzbaq6bjpMcgqtHiy8oghd6YTqU4=,tag:E9I16ndeu5B3FH4KDM3s3Q==,type:str]
        - ENC[AES256_GCM,data:8YlHQ81I5XBn1Tb9Bl2LM4WHeqQtxr4g1DFYQRATCfgGWZA6eD+2,iv:7eA70jzdApdwZIA8jXpNEYnX3Ty11Lie2VChEfzhczU=,tag:PEysBYyv6D6iyzbpoU8aFw==,type:str]
        - ENC[AES256_GCM,data:axGGD4Q0HsHsgGE8RlVFVgEV5uitOPX92+NvjFlChsQhLabxbqBfu2BkVEQ8/Q==,iv:4e1omSD4QOAi2F61LiaErDQFPHtLfx38rtVpxsZsIVo=,tag:bHcO2WrcKEI/KHEk6fBwow==,type:str]
        - ENC[AES256_GCM,data:DpeXUcmOfyplW+LYhQs4uKc4bX3fcSSMUQbIRJS8kxMzsSpMBA==,iv:8yAfnme0ZoPj/o/KE1KOKEjSwgDsRhCWrthCA1+g00o=,tag:luse65hRQA3jbXCOv8JIGg==,type:str]
        - ENC[AES256_GCM,data:UrLgW5N3UESxrpRsdXUTR8ESZwupzAbN42MNLF3OIujAvCEoYeL0nsZGhgg=,iv:4ooiVRkUH8EZrpiiQPeacftDFfXMWyYm98631jhC9Ig=,tag:Nj9NLrBZXK5FuCh3+7T1hw==,type:str]
        - ENC[AES256_GCM,data:OtieFCKE+LNIqh8A8jtExGrKDlURB2BxUZAwhw5PQ1fXhN4o768CCQPzl0DGfw==,iv:iy5HRK/6SuFhQQzadpXOTP5x3RDt4F3wRG0iq/SW+gE=,tag:1X15xw+o6UtIyP75H6iAFg==,type:str]
        - ENC[AES256_GCM,data:TI/lk/xog42ce6+YBdS99VDVwU9FsWKHv9aNU5zmvNpGZtGyJOiBW79KwDp0e+I4xs7H/tA=,iv:KTg8Fll0Qn2cfXSJwEp6q9EU8g0+G2YAuTTYIvevZLM=,tag:Yp8fN7/5WUJYYyx/RC5wzw==,type:str]
        - ENC[AES256_GCM,data:KgUiFaFXvCqmrNMk32jUHO6V3tbQ/xBYudKvjWJUNqBHhAa0r6sW4sn9TmBNrFqS,iv:J79Qfo1QPtQbbAY3j5okDgrFf274KvknMXryHrTD940=,tag:8dp8BzNOEBptSXoicf/9Vg==,type:str]
        - ENC[AES256_GCM,data:HU9nXPRzc95VzL9PbjYkVdjKz/3eH6RSf32aRXjl4jdwLL93YA9CopbjmBWNTlBGNdGmluKRWQ==,iv:tZrFdP4FPpoZ/+9YCnT3qZG8jUg9Mg4qD9mrQR2CAog=,tag:oyU0omYbQG6DGpij8Uw4DQ==,type:str]
    customSettings:
        - dhcp-option=252,"\n"
        - dhcp-option=vendor:MSFT,2,1i
        # DNS
        #- dhcp-option=6,192.168.1.232,192.168.1.1
        - dhcp-option=6,192.168.1.232
        # NTP
        - dhcp-option=42,192.168.1.1
        - dhcp-range=::,ra-names
        - server=/geekbundle.org/192.168.1.1
        - ptr-record=1.1.168.192.in-addr.arpa.,"despair"
        # TFTP Boot
        - dhcp-match=set:ipxe,175
        - dhcp-boot=tag:!ipxe,ipxe.pxe,dns01,192.168.1.11
        - dhcp-match=set:efi-x86_64,option:client-arch,7
        - dhcp-boot=tag:efi-x86_64,ipxe.efi,dns01,192.168.1.11
        - dhcp-boot=http://192.168.1.45:8043/boot.ipxe
        # DHCP Reservation with different dns server
        - dhcp-option=net:customdns,6,9.9.9.9,1.1.1.1
        - dhcp-host=net:customdns,EC:79:49:51:64:16,192.168.1.187,ipl06002-lan
        - dhcp-host=net:customdns,F4:4E:E3:2C:C2:B6,192.168.1.56,ipl06002-wlan
        # DHCP Reservation with unrestricted youtube dns server
        - dhcp-option=net:youtubedns,6,192.168.1.234
        - dhcp-host=net:youtubedns,AC:3E:B1:A6:AF:D6,Pixel-7-Pro
        - dhcp-host=net:youtubedns,E0:80:6B:37:56:83,Redmi-Note-11
        - dhcp-host=net:youtubedns,74:58:F3:E7:3A:04,Fire-Cube-lan
        - dhcp-host=net:youtubedns,48:43:DD:6E:CC:2D,Fire-Cube-wlan
        - dhcp-host=net:youtubedns,F0:27:2D:D7:41:97,Fire-Guest
        - dhcp-host=net:youtubedns,00:e0:4c:7b:c2:98,Sanctuary
        - dhcp-host=net:youtubedns,8c:8c:aa:32:ce:7a,IONB000201752-LAN
        - dhcp-host=net:youtubedns,4e:80:5d:ae:a9:dd,IONB000201752-WLAN
        # HTTP Boot
        #- dhcp-match=set:efi-x86_64_http,option:vendor-class-identifier,0,10
        #- dhcp-boot=tag:efi-x86_64_http,"http://192.168.1.45:8043/ipxe.efi"
        #- dhcp-boot=tag:!ipxe,"http://192.168.1.45:8043/ipxe.pxe"
    #customCnameEntries:
    #- cname=www.youtube.com,restrict.youtube.com
    #- cname=m.youtube.com,restrict.youtube.com
    #- cname=youtubei.googleapis.com,restrict.youtube.com
    #- cname=youtube.googleapis.com,restrict.youtube.com
    #- cname=www.youtube-nocookie.com,restrict.youtube.com
# Not required. We're running a dhcp relay via host network.
#hostNetwork: "true"
capabilities:
    add:
        - NET_ADMIN
        - CAP_SYS_TIME
        - CAP_SYS_NICE
persistentVolumeClaim:
    enabled: true
    existingClaim: pihole
    #storageClass: longhorn
    #size: "10737418240"
podDnsConfig:
    enabled: true
    policy: None
    nameservers:
        - 127.0.0.1
        - 1.1.1.1
#affinity:
#  nodeAffinity:
#    requiredDuringSchedulingIgnoredDuringExecution:
#      nodeSelectorTerms:
#        - matchExpressions:
#            - key: kubernetes.io/hostname
#              operator: In
#              values:
#                - node03
probes:
    liveness:
        initialDelaySeconds: 30
    readiness:
        initialDelaySeconds: 30
affinity:
    podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchExpressions:
                    - key: app.kubernetes.io/name
                      operator: In
                      values:
                        - pihole-02
              topologyKey: kubernetes.io/hostname
sops:
    age:
        - recipient: age1d2g7tgqpfvxulsusn3m608h60h2hne7yqwv5nh5nd24z6h0hgq0skjkhw8
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB4SGdBbkc5WGFXa3NwdTdN
            MnIvamFzQmRoUlBNaEUvSU80b2lVZFJScERVCll1aSsrQmw2UWhncjFMRGVlZk9a
            czZMNVhUMHFiRUQ4T3R3Rk1IUk9MbncKLS0tIFZMNVJhc1NnQmNMM3RXYU1UbUVQ
            T0FWSlljVXRTbllpTktMUit2NjZhd00KvuzCarePtKePSn/uks4Bb43ghiGCoQDn
            ORv09+135fcpyd2e/pud3UaXPpd9rLidmr4N5/snol3ibeo0WQSPHw==
            -----END AGE ENCRYPTED FILE-----
        - recipient: age1q522xtgjrmvr43w7um5rh02ta3yfns635680hz4m7uhw0nfqj5zqgxnz27
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBuMmtrV29Jd2xrOGpRaklL
            SjQ4ZjZXMUh4QXMxN2llTkJCV1pFMnZ2eDNJClRBbzhOYVdKaWp1VEZwdGtyWEp4
            QVRpSHhLZmJNMk1tR3A2RFNsZitybGsKLS0tIEo1QnhPbWY1QTc2UE42bTBtNlh4
            V0pXWGl0Um8yVU9PU2xqOW1XSjFHd3cKv6EnDgWr21oYdKyBihYaPgHLLdSydyCL
            u/hXym6nq/BL/Z8ETIehp7HCIOU5GLTAVEyXatBkXbzN0X+NCiPrqQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-11-16T22:11:11Z"
    mac: ENC[AES256_GCM,data:UPYGcZIPJELd1W0lEwwiiG9SNl81kZ+XQSpHmKbY64EAaMz39j1+P/TeeS+f95x1DhCyxjQySrnBKitjuwGL/ON5DYvWVvYrcJ9AumkglAJ+qv/lV6kX07Kw7hfxupAL7F5R2SWJXR6sZsZ23IT3H34V30wQ10DleBjBhUg5Fvg=,iv:zeFgBvmVKWk+iVy6ix+w+56WTixtNrwmqJpAt7VGzCo=,tag:Y7poq1KfPMtNviwlyW+N2w==,type:str]
    encrypted_regex: ^(data|stringData|email|dnsNames|.*(H|h)osts?|hostname|username|password|url|issuer|argocdServerAdminPassword|oidc.config|commonName|literals|.*awsAccessKeyId|.*awsSecretAccessKey|.*defaultAdminPassword|apiToken|accountId|rootPassword|replicationPassword|adminPassword|root_url|client_secret|auth_url|api_url|PIHOLE_DOMAIN|TUNNEL_DNS_UPSTREAM|customDnsEntries|securityTokenKey|emailRecipients|.*provider_url|.*redirect_url|.*accesskeyEncryption|SEMAPHORE_WEB_ROOT|token|cookieEncryption|cookieHash|^ldap|.*match)$
    version: 3.11.0
