<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta name=author content="Michael Neese"><link href="https://madic-creates.github.io/git-ops/certmanager/" rel="canonical"><link href=../backup/ rel=prev><link href=../databases/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Cert-Manager - Madic | Home GitOps</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel="stylesheet" href="../assets/external/fonts.googleapis.com/css.49ea35f2.css"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Cert-Manager - Madic | Home GitOps"><meta property=og:description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta property=og:image content=https://madic-creates.github.io/git-ops/assets/images/social/certmanager.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta content=https://madic-creates.github.io/git-ops/certmanager/ property=og:url><meta property=twitter:card content=summary_large_image><meta property=twitter:title content="Cert-Manager - Madic | Home GitOps"><meta property=twitter:description content="A mono repository for my home Kubernetes cluster which tries to adhere to Infrastructure as Code (IaC) and GitOps practices"><meta property=twitter:image content=https://madic-creates.github.io/git-ops/assets/images/social/certmanager.png></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#certificate-manager class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Madic | Home GitOps" class="md-header__button md-logo" aria-label="Madic | Home GitOps" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Madic | Home GitOps </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Cert-Manager </span> </div> </div> </div> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href="https://github.com/madic-creates/k3s-git-ops" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> madic-creates/k3s-git-ops </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Madic | Home GitOps" class="md-nav__button md-logo" aria-label="Madic | Home GitOps" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Madic | Home GitOps </label> <div class=md-nav__source> <a href="https://github.com/madic-creates/k3s-git-ops" title="Go to repository" class="md-source" data-md-component="source"> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M202.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M496 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg> </div> <div class=md-source__repository> madic-creates/k3s-git-ops </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../install/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Applications </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Applications </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../argocd/ class=md-nav__link> <span class=md-ellipsis> Argo-CD </span> </a> </li> <li class=md-nav__item> <a href=../auth/ class=md-nav__link> <span class=md-ellipsis> Authentication </span> </a> </li> <li class=md-nav__item> <a href=../backup/ class=md-nav__link> <span class=md-ellipsis> Backup </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Cert-Manager </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Cert-Manager </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#deployment-details class=md-nav__link> <span class=md-ellipsis> Deployment Details </span> </a> <nav class=md-nav aria-label="Deployment Details"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-chart-installation class=md-nav__link> <span class=md-ellipsis> Helm Chart Installation </span> </a> </li> <li class=md-nav__item> <a href=#dns-challenge-configuration class=md-nav__link> <span class=md-ellipsis> DNS Challenge Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#clusterissuers class=md-nav__link> <span class=md-ellipsis> ClusterIssuers </span> </a> <nav class=md-nav aria-label=ClusterIssuers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#production-issuer class=md-nav__link> <span class=md-ellipsis> Production Issuer </span> </a> </li> <li class=md-nav__item> <a href=#staging-issuer class=md-nav__link> <span class=md-ellipsis> Staging Issuer </span> </a> </li> <li class=md-nav__item> <a href=#clusterissuer-configuration class=md-nav__link> <span class=md-ellipsis> ClusterIssuer Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cloudflare-dns-integration class=md-nav__link> <span class=md-ellipsis> CloudFlare DNS Integration </span> </a> <nav class=md-nav aria-label="CloudFlare DNS Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cloudflare-api-token-requirements class=md-nav__link> <span class=md-ellipsis> CloudFlare API Token Requirements </span> </a> </li> <li class=md-nav__item> <a href=#secret-configuration class=md-nav__link> <span class=md-ellipsis> Secret Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#wildcard-certificates class=md-nav__link> <span class=md-ellipsis> Wildcard Certificates </span> </a> <nav class=md-nav aria-label="Wildcard Certificates"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#wildcard-certificate-resources class=md-nav__link> <span class=md-ellipsis> Wildcard Certificate Resources </span> </a> </li> <li class=md-nav__item> <a href=#certificate-distribution-via-reflector class=md-nav__link> <span class=md-ellipsis> Certificate Distribution via Reflector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-certificates-in-ingress-resources class=md-nav__link> <span class=md-ellipsis> Using Certificates in Ingress Resources </span> </a> <nav class=md-nav aria-label="Using Certificates in Ingress Resources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#standard-ingress-with-wildcard-certificate class=md-nav__link> <span class=md-ellipsis> Standard Ingress with Wildcard Certificate </span> </a> </li> <li class=md-nav__item> <a href=#requesting-application-specific-certificates class=md-nav__link> <span class=md-ellipsis> Requesting Application-Specific Certificates </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#certificate-renewal class=md-nav__link> <span class=md-ellipsis> Certificate Renewal </span> </a> <nav class=md-nav aria-label="Certificate Renewal"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#monitoring-certificate-expiration class=md-nav__link> <span class=md-ellipsis> Monitoring Certificate Expiration </span> </a> </li> <li class=md-nav__item> <a href=#certificate-renewal-process class=md-nav__link> <span class=md-ellipsis> Certificate Renewal Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#checking-cert-manager-logs class=md-nav__link> <span class=md-ellipsis> Checking cert-manager Logs </span> </a> </li> <li class=md-nav__item> <a href=#common-issues-and-solutions class=md-nav__link> <span class=md-ellipsis> Common Issues and Solutions </span> </a> <nav class=md-nav aria-label="Common Issues and Solutions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#certificate-not-issuing class=md-nav__link> <span class=md-ellipsis> Certificate Not Issuing </span> </a> </li> <li class=md-nav__item> <a href=#dns-challenge-failing class=md-nav__link> <span class=md-ellipsis> DNS Challenge Failing </span> </a> </li> <li class=md-nav__item> <a href=#certificate-not-distributing-to-namespaces class=md-nav__link> <span class=md-ellipsis> Certificate Not Distributing to Namespaces </span> </a> </li> <li class=md-nav__item> <a href=#rate-limiting class=md-nav__link> <span class=md-ellipsis> Rate Limiting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#extracting-certificate-for-external-use class=md-nav__link> <span class=md-ellipsis> Extracting Certificate for External Use </span> </a> </li> <li class=md-nav__item> <a href=#manual-certificate-renewal class=md-nav__link> <span class=md-ellipsis> Manual Certificate Renewal </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#integration-with-other-components class=md-nav__link> <span class=md-ellipsis> Integration with Other Components </span> </a> <nav class=md-nav aria-label="Integration with Other Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#traefik-ingress-controller class=md-nav__link> <span class=md-ellipsis> Traefik Ingress Controller </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#secret-management-with-sops class=md-nav__link> <span class=md-ellipsis> Secret Management with SOPS </span> </a> </li> <li class=md-nav__item> <a href=#testing-certificate-configuration-locally class=md-nav__link> <span class=md-ellipsis> Testing Certificate Configuration Locally </span> </a> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#related-documentation class=md-nav__link> <span class=md-ellipsis> Related Documentation </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../databases/ class=md-nav__link> <span class=md-ellipsis> Databases </span> </a> </li> <li class=md-nav__item> <a href=../kubedoom/ class=md-nav__link> <span class=md-ellipsis> Kube DOOM </span> </a> </li> <li class=md-nav__item> <a href=../network/ class=md-nav__link> <span class=md-ellipsis> Network </span> </a> </li> <li class=md-nav__item> <a href=../loadbalancer/ class=md-nav__link> <span class=md-ellipsis> LoadBalancer </span> </a> </li> <li class=md-nav__item> <a href=../monitoring/ class=md-nav__link> <span class=md-ellipsis> Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../reflector/ class=md-nav__link> <span class=md-ellipsis> Reflector </span> </a> </li> <li class=md-nav__item> <a href=../secretmanagement/ class=md-nav__link> <span class=md-ellipsis> Secret Management </span> </a> </li> <li class=md-nav__item> <a href=../storage/ class=md-nav__link> <span class=md-ellipsis> Storage </span> </a> </li> <li class=md-nav__item> <a href=../updates/ class=md-nav__link> <span class=md-ellipsis> Updates </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Operations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../operations/longhorn-maintenance/ class=md-nav__link> <span class=md-ellipsis> Longhorn Maintenance </span> </a> </li> <li class=md-nav__item> <a href=../operations/cilium-migration/ class=md-nav__link> <span class=md-ellipsis> Migration to Cilium </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex> <span class=md-ellipsis> Tools </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../helm/ class=md-nav__link> <span class=md-ellipsis> Helm </span> </a> </li> <li class=md-nav__item> <a href=../secrets/ class=md-nav__link> <span class=md-ellipsis> Secrets </span> </a> </li> <li class=md-nav__item> <a href=../mkdocs/ class=md-nav__link> <span class=md-ellipsis> MKDocs </span> </a> </li> <li class=md-nav__item> <a href=../pre-commit-hooks/ class=md-nav__link> <span class=md-ellipsis> Pre-Commit-Hooks </span> </a> </li> <li class=md-nav__item> <a href=../testenv/ class=md-nav__link> <span class=md-ellipsis> Test Environment </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#overview class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=#deployment-details class=md-nav__link> <span class=md-ellipsis> Deployment Details </span> </a> <nav class=md-nav aria-label="Deployment Details"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-chart-installation class=md-nav__link> <span class=md-ellipsis> Helm Chart Installation </span> </a> </li> <li class=md-nav__item> <a href=#dns-challenge-configuration class=md-nav__link> <span class=md-ellipsis> DNS Challenge Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#clusterissuers class=md-nav__link> <span class=md-ellipsis> ClusterIssuers </span> </a> <nav class=md-nav aria-label=ClusterIssuers> <ul class=md-nav__list> <li class=md-nav__item> <a href=#production-issuer class=md-nav__link> <span class=md-ellipsis> Production Issuer </span> </a> </li> <li class=md-nav__item> <a href=#staging-issuer class=md-nav__link> <span class=md-ellipsis> Staging Issuer </span> </a> </li> <li class=md-nav__item> <a href=#clusterissuer-configuration class=md-nav__link> <span class=md-ellipsis> ClusterIssuer Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cloudflare-dns-integration class=md-nav__link> <span class=md-ellipsis> CloudFlare DNS Integration </span> </a> <nav class=md-nav aria-label="CloudFlare DNS Integration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cloudflare-api-token-requirements class=md-nav__link> <span class=md-ellipsis> CloudFlare API Token Requirements </span> </a> </li> <li class=md-nav__item> <a href=#secret-configuration class=md-nav__link> <span class=md-ellipsis> Secret Configuration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#wildcard-certificates class=md-nav__link> <span class=md-ellipsis> Wildcard Certificates </span> </a> <nav class=md-nav aria-label="Wildcard Certificates"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#wildcard-certificate-resources class=md-nav__link> <span class=md-ellipsis> Wildcard Certificate Resources </span> </a> </li> <li class=md-nav__item> <a href=#certificate-distribution-via-reflector class=md-nav__link> <span class=md-ellipsis> Certificate Distribution via Reflector </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#using-certificates-in-ingress-resources class=md-nav__link> <span class=md-ellipsis> Using Certificates in Ingress Resources </span> </a> <nav class=md-nav aria-label="Using Certificates in Ingress Resources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#standard-ingress-with-wildcard-certificate class=md-nav__link> <span class=md-ellipsis> Standard Ingress with Wildcard Certificate </span> </a> </li> <li class=md-nav__item> <a href=#requesting-application-specific-certificates class=md-nav__link> <span class=md-ellipsis> Requesting Application-Specific Certificates </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#certificate-renewal class=md-nav__link> <span class=md-ellipsis> Certificate Renewal </span> </a> <nav class=md-nav aria-label="Certificate Renewal"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#monitoring-certificate-expiration class=md-nav__link> <span class=md-ellipsis> Monitoring Certificate Expiration </span> </a> </li> <li class=md-nav__item> <a href=#certificate-renewal-process class=md-nav__link> <span class=md-ellipsis> Certificate Renewal Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#checking-cert-manager-logs class=md-nav__link> <span class=md-ellipsis> Checking cert-manager Logs </span> </a> </li> <li class=md-nav__item> <a href=#common-issues-and-solutions class=md-nav__link> <span class=md-ellipsis> Common Issues and Solutions </span> </a> <nav class=md-nav aria-label="Common Issues and Solutions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#certificate-not-issuing class=md-nav__link> <span class=md-ellipsis> Certificate Not Issuing </span> </a> </li> <li class=md-nav__item> <a href=#dns-challenge-failing class=md-nav__link> <span class=md-ellipsis> DNS Challenge Failing </span> </a> </li> <li class=md-nav__item> <a href=#certificate-not-distributing-to-namespaces class=md-nav__link> <span class=md-ellipsis> Certificate Not Distributing to Namespaces </span> </a> </li> <li class=md-nav__item> <a href=#rate-limiting class=md-nav__link> <span class=md-ellipsis> Rate Limiting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#extracting-certificate-for-external-use class=md-nav__link> <span class=md-ellipsis> Extracting Certificate for External Use </span> </a> </li> <li class=md-nav__item> <a href=#manual-certificate-renewal class=md-nav__link> <span class=md-ellipsis> Manual Certificate Renewal </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#integration-with-other-components class=md-nav__link> <span class=md-ellipsis> Integration with Other Components </span> </a> <nav class=md-nav aria-label="Integration with Other Components"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#traefik-ingress-controller class=md-nav__link> <span class=md-ellipsis> Traefik Ingress Controller </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#secret-management-with-sops class=md-nav__link> <span class=md-ellipsis> Secret Management with SOPS </span> </a> </li> <li class=md-nav__item> <a href=#testing-certificate-configuration-locally class=md-nav__link> <span class=md-ellipsis> Testing Certificate Configuration Locally </span> </a> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#related-documentation class=md-nav__link> <span class=md-ellipsis> Related Documentation </span> </a> </li> <li class=md-nav__item> <a href=#references class=md-nav__link> <span class=md-ellipsis> References </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=certificate-manager>Certificate Manager<a class=headerlink href=#certificate-manager title="Permanent link">#</a></h1> <p>cert-manager is a Kubernetes add-on that automates the management and issuance of TLS certificates from various issuing sources. In this cluster, it handles all TLS certificate provisioning for ingress resources using Let's Encrypt as the certificate authority with CloudFlare DNS-01 challenges.</p> <h2 id=overview>Overview<a class=headerlink href=#overview title="Permanent link">#</a></h2> <p>The cert-manager deployment in this cluster provides:</p> <ul> <li>Automated certificate issuance from Let's Encrypt (staging and production)</li> <li>DNS-01 challenge solving via CloudFlare API integration</li> <li>Wildcard certificate support</li> <li>Automatic certificate renewal before expiration</li> <li>Certificate distribution across namespaces via Reflector</li> <li>Integration with Traefik ingress controller</li> </ul> <h2 id=deployment-details>Deployment Details<a class=headerlink href=#deployment-details title="Permanent link">#</a></h2> <h3 id=helm-chart-installation>Helm Chart Installation<a class=headerlink href=#helm-chart-installation title="Permanent link">#</a></h3> <p>cert-manager is deployed via ArgoCD using the Kustomize Helm chart integration. The deployment is managed in <code>/apps/certmanager/</code> with sync wave priority <code>1</code>, making it one of the first applications to be deployed after core infrastructure.</p> <p><strong>Version</strong>: v1.19.0 (Helm chart from <a href="https://charts.jetstack.io">https://charts.jetstack.io</a>)</p> <p><strong>ArgoCD Application</strong>: <code>apps/argo-cd-apps/01-certmanager.yaml</code></p> <p><strong>Key Configuration Options</strong>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>helmCharts</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager</span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>    </span><span class=nt>repo</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://charts.jetstack.io</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1.19.0</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>    </span><span class=nt>releaseName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager</span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">certmanager</span>
<a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>    </span><span class=nt>valuesInline</span><span class=p>:</span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>      </span><span class=nt>crds</span><span class=p>:</span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>        </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=w>        </span><span class=nt>keep</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=w>      </span><span class=nt>dns01RecursiveNameserversOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=w>      </span><span class=nt>dns01RecursiveNameservers</span><span class=p>:</span><span class=w> </span><span class=s>&quot;9.9.9.9:53,1.1.1.1:53&quot;</span>
<a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=w>      </span><span class=nt>global</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>        </span><span class=nt>revisionHistoryLimit</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div></td></tr></table></div> <h3 id=dns-challenge-configuration>DNS Challenge Configuration<a class=headerlink href=#dns-challenge-configuration title="Permanent link">#</a></h3> <p>The cluster uses DNS-01 challenges instead of HTTP-01 challenges. This approach has several advantages:</p> <ul> <li>Supports wildcard certificates</li> <li>Works behind firewalls or private networks</li> <li>No need to expose port 80 during validation</li> </ul> <p>The DNS challenge uses recursive nameservers (Quad9 and Cloudflare) to ensure reliable DNS propagation checking before attempting validation with Let's Encrypt.</p> <h2 id=clusterissuers>ClusterIssuers<a class=headerlink href=#clusterissuers title="Permanent link">#</a></h2> <p>Two ClusterIssuers are configured for certificate management:</p> <h3 id=production-issuer>Production Issuer<a class=headerlink href=#production-issuer title="Permanent link">#</a></h3> <p><strong>Name</strong>: <code>cloudflare-issuer-production</code></p> <p><strong>ACME Server</strong>: <code>https://acme-v02.api.letsencrypt.org/directory</code></p> <p>This issuer is used for production certificates with Let's Encrypt's rate limits enforced. It is the default issuer for all production ingress resources.</p> <h3 id=staging-issuer>Staging Issuer<a class=headerlink href=#staging-issuer title="Permanent link">#</a></h3> <p><strong>Name</strong>: <code>cloudflare-issuer-staging</code></p> <p><strong>ACME Server</strong>: <code>https://acme-staging-v02.api.letsencrypt.org/directory</code></p> <p>This issuer should be used for testing certificate configuration before switching to production. The staging server has much higher rate limits and issues certificates from a test CA that browsers will not trust.</p> <h3 id=clusterissuer-configuration>ClusterIssuer Configuration<a class=headerlink href=#clusterissuer-configuration title="Permanent link">#</a></h3> <p>Both issuers are configured with the following key settings:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1> 1</a></span>
<span class=normal><a href=#__codelineno-1-2> 2</a></span>
<span class=normal><a href=#__codelineno-1-3> 3</a></span>
<span class=normal><a href=#__codelineno-1-4> 4</a></span>
<span class=normal><a href=#__codelineno-1-5> 5</a></span>
<span class=normal><a href=#__codelineno-1-6> 6</a></span>
<span class=normal><a href=#__codelineno-1-7> 7</a></span>
<span class=normal><a href=#__codelineno-1-8> 8</a></span>
<span class=normal><a href=#__codelineno-1-9> 9</a></span>
<span class=normal><a href=#__codelineno-1-10>10</a></span>
<span class=normal><a href=#__codelineno-1-11>11</a></span>
<span class=normal><a href=#__codelineno-1-12>12</a></span>
<span class=normal><a href=#__codelineno-1-13>13</a></span>
<span class=normal><a href=#__codelineno-1-14>14</a></span>
<span class=normal><a href=#__codelineno-1-15>15</a></span>
<span class=normal><a href=#__codelineno-1-16>16</a></span>
<span class=normal><a href=#__codelineno-1-17>17</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-issuer-production</span>
<a id=__codelineno-1-5 name=__codelineno-1-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>  </span><span class=nt>acme</span><span class=p>:</span>
<a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>    </span><span class=nt>server</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span>
<a id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>    </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;encrypted-email&gt;</span>
<a id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>    </span><span class=nt>privateKeySecretRef</span><span class=p>:</span>
<a id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-le-secret</span>
<a id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>    </span><span class=nt>solvers</span><span class=p>:</span>
<a id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>dns01</span><span class=p>:</span>
<a id=__codelineno-1-13 name=__codelineno-1-13></a><span class=w>          </span><span class=nt>cloudflare</span><span class=p>:</span>
<a id=__codelineno-1-14 name=__codelineno-1-14></a><span class=w>            </span><span class=nt>email</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;encrypted-email&gt;</span>
<a id=__codelineno-1-15 name=__codelineno-1-15></a><span class=w>            </span><span class=nt>apiTokenSecretRef</span><span class=p>:</span>
<a id=__codelineno-1-16 name=__codelineno-1-16></a><span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-api-token</span>
<a id=__codelineno-1-17 name=__codelineno-1-17></a><span class=w>              </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-token</span>
</code></pre></div></td></tr></table></div> <p>The ClusterIssuer definitions are stored in encrypted form at <code>/apps/certmanager/cloudflare_issuer.enc.yaml</code>.</p> <h2 id=cloudflare-dns-integration>CloudFlare DNS Integration<a class=headerlink href=#cloudflare-dns-integration title="Permanent link">#</a></h2> <p>cert-manager uses a CloudFlare API token to manipulate DNS records for DNS-01 challenge validation. The API token is stored as an encrypted Kubernetes secret in <code>/apps/certmanager/secrets.enc.yaml</code>.</p> <h3 id=cloudflare-api-token-requirements>CloudFlare API Token Requirements<a class=headerlink href=#cloudflare-api-token-requirements title="Permanent link">#</a></h3> <p>The API token must have the following permissions:</p> <ul> <li><strong>Zone</strong>: DNS:Edit for the zones you want to issue certificates for</li> <li><strong>Zone</strong>: Zone:Read for the zones you want to issue certificates for</li> </ul> <h3 id=secret-configuration>Secret Configuration<a class=headerlink href=#secret-configuration title="Permanent link">#</a></h3> <p>The CloudFlare API token is stored in a Kubernetes secret:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span>
<span class=normal><a href=#__codelineno-2-3>3</a></span>
<span class=normal><a href=#__codelineno-2-4>4</a></span>
<span class=normal><a href=#__codelineno-2-5>5</a></span>
<span class=normal><a href=#__codelineno-2-6>6</a></span>
<span class=normal><a href=#__codelineno-2-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-api-token</span>
<a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">certmanager</span>
<a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>  </span><span class=nt>api-token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;base64-encoded-token&gt;</span>
</code></pre></div></td></tr></table></div> <p>This secret is referenced by both ClusterIssuers and must be available in the <code>certmanager</code> namespace before certificate issuance can succeed.</p> <h2 id=wildcard-certificates>Wildcard Certificates<a class=headerlink href=#wildcard-certificates title="Permanent link">#</a></h2> <p>The cluster uses pre-provisioned wildcard certificates that are automatically distributed to all namespaces using the <a href=../reflector/ >Reflector</a> operator. This approach has several advantages:</p> <ul> <li>Single certificate covers all subdomains</li> <li>Reduces Let's Encrypt rate limit consumption</li> <li>Certificates are available immediately in new namespaces</li> <li>Centralized certificate management</li> </ul> <h3 id=wildcard-certificate-resources>Wildcard Certificate Resources<a class=headerlink href=#wildcard-certificate-resources title="Permanent link">#</a></h3> <p>Two wildcard certificates are configured in <code>/apps/certmanager/wildcard.enc.yaml</code>:</p> <ol> <li><strong>wildcard-cloudflare-production-01</strong>: Covers the primary domain</li> <li><strong>wildcard-cloudflare-production-02</strong>: Covers a secondary domain</li> </ol> <p>Example certificate configuration:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1> 1</a></span>
<span class=normal><a href=#__codelineno-3-2> 2</a></span>
<span class=normal><a href=#__codelineno-3-3> 3</a></span>
<span class=normal><a href=#__codelineno-3-4> 4</a></span>
<span class=normal><a href=#__codelineno-3-5> 5</a></span>
<span class=normal><a href=#__codelineno-3-6> 6</a></span>
<span class=normal><a href=#__codelineno-3-7> 7</a></span>
<span class=normal><a href=#__codelineno-3-8> 8</a></span>
<span class=normal><a href=#__codelineno-3-9> 9</a></span>
<span class=normal><a href=#__codelineno-3-10>10</a></span>
<span class=normal><a href=#__codelineno-3-11>11</a></span>
<span class=normal><a href=#__codelineno-3-12>12</a></span>
<span class=normal><a href=#__codelineno-3-13>13</a></span>
<span class=normal><a href=#__codelineno-3-14>14</a></span>
<span class=normal><a href=#__codelineno-3-15>15</a></span>
<span class=normal><a href=#__codelineno-3-16>16</a></span>
<span class=normal><a href=#__codelineno-3-17>17</a></span>
<span class=normal><a href=#__codelineno-3-18>18</a></span>
<span class=normal><a href=#__codelineno-3-19>19</a></span>
<span class=normal><a href=#__codelineno-3-20>20</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wildcard-cloudflare-production-01</span>
<a id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">certmanager</span>
<a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>  </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wildcard-cloudflare-production-01</span>
<a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>  </span><span class=nt>privateKey</span><span class=p>:</span>
<a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=w>    </span><span class=nt>algorithm</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ECDSA</span>
<a id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256</span>
<a id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>  </span><span class=nt>issuerRef</span><span class=p>:</span>
<a id=__codelineno-3-12 name=__codelineno-3-12></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-issuer-production</span>
<a id=__codelineno-3-13 name=__codelineno-3-13></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<a id=__codelineno-3-14 name=__codelineno-3-14></a><span class=w>  </span><span class=nt>commonName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;encrypted-domain&gt;</span>
<a id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>  </span><span class=nt>dnsNames</span><span class=p>:</span>
<a id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;encrypted-wildcard-domain&gt;</span>
<a id=__codelineno-3-17 name=__codelineno-3-17></a><span class=w>  </span><span class=nt>secretTemplate</span><span class=p>:</span>
<a id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>    </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-3-19 name=__codelineno-3-19></a><span class=w>      </span><span class=nt>reflector.v1.k8s.emberstack.com/reflection-allowed</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-3-20 name=__codelineno-3-20></a><span class=w>      </span><span class=nt>reflector.v1.k8s.emberstack.com/reflection-auto-enabled</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
</code></pre></div></td></tr></table></div> <h3 id=certificate-distribution-via-reflector>Certificate Distribution via Reflector<a class=headerlink href=#certificate-distribution-via-reflector title="Permanent link">#</a></h3> <p>The <code>secretTemplate</code> section includes Reflector annotations that automatically distribute the certificate secret to all namespaces:</p> <ul> <li><code>reflector.v1.k8s.emberstack.com/reflection-allowed: "true"</code>: Enables the secret to be reflected</li> <li><code>reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"</code>: Automatically creates copies in all namespaces</li> </ul> <p>This means that once a wildcard certificate is issued in the <code>certmanager</code> namespace, it is immediately available in all other namespaces without manual intervention.</p> <h2 id=using-certificates-in-ingress-resources>Using Certificates in Ingress Resources<a class=headerlink href=#using-certificates-in-ingress-resources title="Permanent link">#</a></h2> <h3 id=standard-ingress-with-wildcard-certificate>Standard Ingress with Wildcard Certificate<a class=headerlink href=#standard-ingress-with-wildcard-certificate title="Permanent link">#</a></h3> <p>Most ingress resources in this cluster use the pre-provisioned wildcard certificates. Here's an example:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span>
<span class=normal><a href=#__codelineno-4-20>20</a></span>
<span class=normal><a href=#__codelineno-4-21>21</a></span>
<span class=normal><a href=#__codelineno-4-22>22</a></span>
<span class=normal><a href=#__codelineno-4-23>23</a></span>
<span class=normal><a href=#__codelineno-4-24>24</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lldap</span>
<a id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>    </span><span class=nt>traefik.ingress.kubernetes.io/router.entrypoints</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web239,websecure239</span>
<a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>    </span><span class=nt>traefik.ingress.kubernetes.io/router.tls</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>  </span><span class=nt>ingressClassName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">traefik</span>
<a id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lldap.example.com</span>
<a id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wildcard-cloudflare-production-02</span>
<a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lldap.example.com</span>
<a id=__codelineno-4-16 name=__codelineno-4-16></a><span class=w>      </span><span class=nt>http</span><span class=p>:</span>
<a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=w>        </span><span class=nt>paths</span><span class=p>:</span>
<a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=w>            </span><span class=nt>pathType</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<a id=__codelineno-4-20 name=__codelineno-4-20></a><span class=w>            </span><span class=nt>backend</span><span class=p>:</span>
<a id=__codelineno-4-21 name=__codelineno-4-21></a><span class=w>              </span><span class=nt>service</span><span class=p>:</span>
<a id=__codelineno-4-22 name=__codelineno-4-22></a><span class=w>                </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">lldap</span>
<a id=__codelineno-4-23 name=__codelineno-4-23></a><span class=w>                </span><span class=nt>port</span><span class=p>:</span>
<a id=__codelineno-4-24 name=__codelineno-4-24></a><span class=w>                  </span><span class=nt>number</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">17170</span>
</code></pre></div></td></tr></table></div> <p>Key points:</p> <ul> <li>The <code>tls</code> section references one of the wildcard certificate secrets</li> <li>The secret is automatically available in the namespace via Reflector</li> <li>No cert-manager annotations are needed when using pre-provisioned certificates</li> <li>The hostname must match the wildcard pattern</li> </ul> <h3 id=requesting-application-specific-certificates>Requesting Application-Specific Certificates<a class=headerlink href=#requesting-application-specific-certificates title="Permanent link">#</a></h3> <p>If you need a certificate for a specific application that is not covered by the wildcard certificates, you can create a Certificate resource:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp-tls</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>  </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp-tls</span>
<a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=w>  </span><span class=nt>issuerRef</span><span class=p>:</span>
<a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cloudflare-issuer-production</span>
<a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
<a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>  </span><span class=nt>dnsNames</span><span class=p>:</span>
<a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
<a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www.myapp.example.com</span>
</code></pre></div></td></tr></table></div> <p>Then reference it in your Ingress:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1> 1</a></span>
<span class=normal><a href=#__codelineno-6-2> 2</a></span>
<span class=normal><a href=#__codelineno-6-3> 3</a></span>
<span class=normal><a href=#__codelineno-6-4> 4</a></span>
<span class=normal><a href=#__codelineno-6-5> 5</a></span>
<span class=normal><a href=#__codelineno-6-6> 6</a></span>
<span class=normal><a href=#__codelineno-6-7> 7</a></span>
<span class=normal><a href=#__codelineno-6-8> 8</a></span>
<span class=normal><a href=#__codelineno-6-9> 9</a></span>
<span class=normal><a href=#__codelineno-6-10>10</a></span>
<span class=normal><a href=#__codelineno-6-11>11</a></span>
<span class=normal><a href=#__codelineno-6-12>12</a></span>
<span class=normal><a href=#__codelineno-6-13>13</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
<a id=__codelineno-6-3 name=__codelineno-6-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-6-4 name=__codelineno-6-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
<a id=__codelineno-6-5 name=__codelineno-6-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-6-6 name=__codelineno-6-6></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-6-7 name=__codelineno-6-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-6-8 name=__codelineno-6-8></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
<a id=__codelineno-6-9 name=__codelineno-6-9></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">www.myapp.example.com</span>
<a id=__codelineno-6-10 name=__codelineno-6-10></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp-tls</span>
<a id=__codelineno-6-11 name=__codelineno-6-11></a><span class=w>  </span><span class=nt>rules</span><span class=p>:</span>
<a id=__codelineno-6-12 name=__codelineno-6-12></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>host</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp.example.com</span>
<a id=__codelineno-6-13 name=__codelineno-6-13></a><span class=w>      </span><span class=c1># ... rest of ingress configuration</span>
</code></pre></div></td></tr></table></div> <h2 id=certificate-renewal>Certificate Renewal<a class=headerlink href=#certificate-renewal title="Permanent link">#</a></h2> <p>cert-manager automatically renews certificates before they expire. The default renewal window is 30 days before expiration (for Let's Encrypt's 90-day certificates, renewal happens around day 60).</p> <h3 id=monitoring-certificate-expiration>Monitoring Certificate Expiration<a class=headerlink href=#monitoring-certificate-expiration title="Permanent link">#</a></h3> <p>You can check certificate status using kubectl:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span>
<span class=normal><a href=#__codelineno-7-2>2</a></span>
<span class=normal><a href=#__codelineno-7-3>3</a></span>
<span class=normal><a href=#__codelineno-7-4>4</a></span>
<span class=normal><a href=#__codelineno-7-5>5</a></span>
<span class=normal><a href=#__codelineno-7-6>6</a></span>
<span class=normal><a href=#__codelineno-7-7>7</a></span>
<span class=normal><a href=#__codelineno-7-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=c1># View all certificates</span>
<a id=__codelineno-7-2 name=__codelineno-7-2></a>kubectl<span class=w> </span>get<span class=w> </span>certificates<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-7-3 name=__codelineno-7-3></a>
<a id=__codelineno-7-4 name=__codelineno-7-4></a><span class=c1># Check certificate details</span>
<a id=__codelineno-7-5 name=__codelineno-7-5></a>kubectl<span class=w> </span>describe<span class=w> </span>certificate<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-7-6 name=__codelineno-7-6></a>
<a id=__codelineno-7-7 name=__codelineno-7-7></a><span class=c1># View certificate renewal status</span>
<a id=__codelineno-7-8 name=__codelineno-7-8></a>kubectl<span class=w> </span>get<span class=w> </span>certificaterequest<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div> <h3 id=certificate-renewal-process>Certificate Renewal Process<a class=headerlink href=#certificate-renewal-process title="Permanent link">#</a></h3> <ol> <li>cert-manager monitors certificate expiration dates</li> <li>When a certificate enters the renewal window, cert-manager creates a CertificateRequest</li> <li>The ClusterIssuer creates a DNS challenge record via CloudFlare API</li> <li>Let's Encrypt validates the DNS record</li> <li>cert-manager retrieves the new certificate and updates the Secret</li> <li>Reflector automatically distributes the updated certificate to all namespaces</li> </ol> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">#</a></h2> <h3 id=checking-cert-manager-logs>Checking cert-manager Logs<a class=headerlink href=#checking-cert-manager-logs title="Permanent link">#</a></h3> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span>
<span class=normal><a href=#__codelineno-8-2>2</a></span>
<span class=normal><a href=#__codelineno-8-3>3</a></span>
<span class=normal><a href=#__codelineno-8-4>4</a></span>
<span class=normal><a href=#__codelineno-8-5>5</a></span>
<span class=normal><a href=#__codelineno-8-6>6</a></span>
<span class=normal><a href=#__codelineno-8-7>7</a></span>
<span class=normal><a href=#__codelineno-8-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=c1># View cert-manager controller logs</span>
<a id=__codelineno-8-2 name=__codelineno-8-2></a>kubectl<span class=w> </span>logs<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>cert-manager<span class=w> </span>-f
<a id=__codelineno-8-3 name=__codelineno-8-3></a>
<a id=__codelineno-8-4 name=__codelineno-8-4></a><span class=c1># View webhook logs</span>
<a id=__codelineno-8-5 name=__codelineno-8-5></a>kubectl<span class=w> </span>logs<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>webhook<span class=w> </span>-f
<a id=__codelineno-8-6 name=__codelineno-8-6></a>
<a id=__codelineno-8-7 name=__codelineno-8-7></a><span class=c1># View cainjector logs</span>
<a id=__codelineno-8-8 name=__codelineno-8-8></a>kubectl<span class=w> </span>logs<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>cainjector<span class=w> </span>-f
</code></pre></div></td></tr></table></div> <h3 id=common-issues-and-solutions>Common Issues and Solutions<a class=headerlink href=#common-issues-and-solutions title="Permanent link">#</a></h3> <h4 id=certificate-not-issuing>Certificate Not Issuing<a class=headerlink href=#certificate-not-issuing title="Permanent link">#</a></h4> <p><strong>Symptoms</strong>: Certificate remains in "Pending" state</p> <p><strong>Troubleshooting steps</strong>:</p> <ol> <li> <p>Check the Certificate status: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a>kubectl<span class=w> </span>describe<span class=w> </span>certificate<span class=w> </span>&lt;certificate-name&gt;<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check for CertificateRequest objects: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span>
<span class=normal><a href=#__codelineno-10-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a>kubectl<span class=w> </span>get<span class=w> </span>certificaterequest<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-10-2 name=__codelineno-10-2></a>kubectl<span class=w> </span>describe<span class=w> </span>certificaterequest<span class=w> </span>&lt;request-name&gt;<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check the Order and Challenge status: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span>
<span class=normal><a href=#__codelineno-11-2>2</a></span>
<span class=normal><a href=#__codelineno-11-3>3</a></span>
<span class=normal><a href=#__codelineno-11-4>4</a></span>
<span class=normal><a href=#__codelineno-11-5>5</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a>kubectl<span class=w> </span>get<span class=w> </span>orders<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-11-2 name=__codelineno-11-2></a>kubectl<span class=w> </span>describe<span class=w> </span>order<span class=w> </span>&lt;order-name&gt;<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-11-3 name=__codelineno-11-3></a>
<a id=__codelineno-11-4 name=__codelineno-11-4></a>kubectl<span class=w> </span>get<span class=w> </span>challenges<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-11-5 name=__codelineno-11-5></a>kubectl<span class=w> </span>describe<span class=w> </span>challenge<span class=w> </span>&lt;challenge-name&gt;<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Verify CloudFlare API token permissions and validity</p> </li> </ol> <h4 id=dns-challenge-failing>DNS Challenge Failing<a class=headerlink href=#dns-challenge-failing title="Permanent link">#</a></h4> <p><strong>Symptoms</strong>: Challenge remains in "Pending" state, events show DNS validation failures</p> <p><strong>Troubleshooting steps</strong>:</p> <ol> <li> <p>Verify the CloudFlare API token secret exists: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>cloudflare-api-token<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check if DNS records are being created in CloudFlare: - Log into CloudFlare dashboard - Navigate to DNS records for your domain - Look for <code>_acme-challenge</code> TXT records</p> </li> <li> <p>Verify DNS propagation: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span>
<span class=normal><a href=#__codelineno-13-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1></a>dig<span class=w> </span>_acme-challenge.example.com<span class=w> </span>TXT<span class=w> </span>@9.9.9.9
<a id=__codelineno-13-2 name=__codelineno-13-2></a>dig<span class=w> </span>_acme-challenge.example.com<span class=w> </span>TXT<span class=w> </span>@1.1.1.1
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check cert-manager can reach DNS servers: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1></a>kubectl<span class=w> </span>logs<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>cert-manager<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-i<span class=w> </span>dns
</code></pre></div></td></tr></table></div></p> </li> </ol> <h4 id=certificate-not-distributing-to-namespaces>Certificate Not Distributing to Namespaces<a class=headerlink href=#certificate-not-distributing-to-namespaces title="Permanent link">#</a></h4> <p><strong>Symptoms</strong>: Certificate exists in <code>certmanager</code> namespace but not in other namespaces</p> <p><strong>Troubleshooting steps</strong>:</p> <ol> <li> <p>Verify Reflector is running: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-15-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1></a>kubectl<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-n<span class=w> </span>reflector
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check Reflector annotations on the certificate secret: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-16-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-A5<span class=w> </span>annotations
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Check Reflector logs: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-17-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1></a>kubectl<span class=w> </span>logs<span class=w> </span>-n<span class=w> </span>reflector<span class=w> </span>-l<span class=w> </span>app.kubernetes.io/name<span class=o>=</span>reflector
</code></pre></div></td></tr></table></div></p> </li> <li> <p>Verify the certificate secret exists in the source namespace: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-18-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div></p> </li> </ol> <h4 id=rate-limiting>Rate Limiting<a class=headerlink href=#rate-limiting title="Permanent link">#</a></h4> <p><strong>Symptoms</strong>: Certificate issuance fails with rate limit errors</p> <p><strong>Solutions</strong>:</p> <ol> <li> <p>Use the staging issuer for testing: - Change <code>issuerRef.name</code> to <code>cloudflare-issuer-staging</code> - Test your configuration thoroughly - Switch back to production issuer once verified</p> </li> <li> <p>Let's Encrypt rate limits: - 50 certificates per registered domain per week - 5 duplicate certificates per week - Use wildcard certificates to reduce certificate count</p> </li> <li> <p>Wait for rate limit window to reset (usually 7 days)</p> </li> </ol> <h3 id=extracting-certificate-for-external-use>Extracting Certificate for External Use<a class=headerlink href=#extracting-certificate-for-external-use title="Permanent link">#</a></h3> <p>If you need to extract a certificate and private key for use outside Kubernetes:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-19-1> 1</a></span>
<span class=normal><a href=#__codelineno-19-2> 2</a></span>
<span class=normal><a href=#__codelineno-19-3> 3</a></span>
<span class=normal><a href=#__codelineno-19-4> 4</a></span>
<span class=normal><a href=#__codelineno-19-5> 5</a></span>
<span class=normal><a href=#__codelineno-19-6> 6</a></span>
<span class=normal><a href=#__codelineno-19-7> 7</a></span>
<span class=normal><a href=#__codelineno-19-8> 8</a></span>
<span class=normal><a href=#__codelineno-19-9> 9</a></span>
<span class=normal><a href=#__codelineno-19-10>10</a></span>
<span class=normal><a href=#__codelineno-19-11>11</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1></a><span class=c1># Extract certificate</span>
<a id=__codelineno-19-2 name=__codelineno-19-2></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-3 name=__codelineno-19-3></a><span class=w>  </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data[&#39;tls\.crt&#39;]}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>-d<span class=w> </span>&gt;<span class=w> </span>certificate.crt
<a id=__codelineno-19-4 name=__codelineno-19-4></a>
<a id=__codelineno-19-5 name=__codelineno-19-5></a><span class=c1># Extract private key (handle with care!)</span>
<a id=__codelineno-19-6 name=__codelineno-19-6></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-7 name=__codelineno-19-7></a><span class=w>  </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data[&#39;tls\.key&#39;]}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>-d<span class=w> </span>&gt;<span class=w> </span>private.key
<a id=__codelineno-19-8 name=__codelineno-19-8></a>
<a id=__codelineno-19-9 name=__codelineno-19-9></a><span class=c1># Extract CA certificate if present</span>
<a id=__codelineno-19-10 name=__codelineno-19-10></a>kubectl<span class=w> </span>get<span class=w> </span>secret<span class=w> </span>-n<span class=w> </span>certmanager<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span><span class=se>\</span>
<a id=__codelineno-19-11 name=__codelineno-19-11></a><span class=w>  </span>-o<span class=w> </span><span class=nv>jsonpath</span><span class=o>=</span><span class=s2>&quot;{.data[&#39;ca\.crt&#39;]}&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64<span class=w> </span>-d<span class=w> </span>&gt;<span class=w> </span>ca.crt
</code></pre></div></td></tr></table></div> <p><strong>Security note</strong>: Handle private keys with extreme care. Never commit them to version control or share them insecurely.</p> <h3 id=manual-certificate-renewal>Manual Certificate Renewal<a class=headerlink href=#manual-certificate-renewal title="Permanent link">#</a></h3> <p>To force certificate renewal (e.g., after fixing an issue):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-20-1>1</a></span>
<span class=normal><a href=#__codelineno-20-2>2</a></span>
<span class=normal><a href=#__codelineno-20-3>3</a></span>
<span class=normal><a href=#__codelineno-20-4>4</a></span>
<span class=normal><a href=#__codelineno-20-5>5</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1></a><span class=c1># Delete the secret to trigger re-issuance</span>
<a id=__codelineno-20-2 name=__codelineno-20-2></a>kubectl<span class=w> </span>delete<span class=w> </span>secret<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span>-n<span class=w> </span>certmanager
<a id=__codelineno-20-3 name=__codelineno-20-3></a>
<a id=__codelineno-20-4 name=__codelineno-20-4></a><span class=c1># Or use cmctl to renew</span>
<a id=__codelineno-20-5 name=__codelineno-20-5></a>cmctl<span class=w> </span>renew<span class=w> </span>wildcard-cloudflare-production-01<span class=w> </span>-n<span class=w> </span>certmanager
</code></pre></div></td></tr></table></div> <h2 id=integration-with-other-components>Integration with Other Components<a class=headerlink href=#integration-with-other-components title="Permanent link">#</a></h2> <h3 id=traefik-ingress-controller>Traefik Ingress Controller<a class=headerlink href=#traefik-ingress-controller title="Permanent link">#</a></h3> <p>All ingress resources in this cluster use Traefik as the ingress controller. Traefik automatically reads certificate secrets referenced in the <code>tls</code> section of Ingress resources.</p> <p>Example Traefik ingress with TLS:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-21-1>1</a></span>
<span class=normal><a href=#__codelineno-21-2>2</a></span>
<span class=normal><a href=#__codelineno-21-3>3</a></span>
<span class=normal><a href=#__codelineno-21-4>4</a></span>
<span class=normal><a href=#__codelineno-21-5>5</a></span>
<span class=normal><a href=#__codelineno-21-6>6</a></span>
<span class=normal><a href=#__codelineno-21-7>7</a></span>
<span class=normal><a href=#__codelineno-21-8>8</a></span>
<span class=normal><a href=#__codelineno-21-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-21-2 name=__codelineno-21-2></a><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span>
<a id=__codelineno-21-3 name=__codelineno-21-3></a><span class=w>    </span><span class=nt>traefik.ingress.kubernetes.io/router.entrypoints</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web239,websecure239</span>
<a id=__codelineno-21-4 name=__codelineno-21-4></a><span class=w>    </span><span class=nt>traefik.ingress.kubernetes.io/router.tls</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<a id=__codelineno-21-5 name=__codelineno-21-5></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-21-6 name=__codelineno-21-6></a><span class=w>  </span><span class=nt>tls</span><span class=p>:</span>
<a id=__codelineno-21-7 name=__codelineno-21-7></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>hosts</span><span class=p>:</span>
<a id=__codelineno-21-8 name=__codelineno-21-8></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app.example.com</span>
<a id=__codelineno-21-9 name=__codelineno-21-9></a><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">wildcard-cloudflare-production-02</span>
</code></pre></div></td></tr></table></div> <h2 id=secret-management-with-sops>Secret Management with SOPS<a class=headerlink href=#secret-management-with-sops title="Permanent link">#</a></h2> <p>All cert-manager configuration files containing sensitive data are encrypted using SOPS with age encryption:</p> <ul> <li><code>/apps/certmanager/cloudflare_issuer.enc.yaml</code>: ClusterIssuer definitions with encrypted email addresses</li> <li><code>/apps/certmanager/wildcard.enc.yaml</code>: Certificate resources with encrypted domain names</li> <li><code>/apps/certmanager/secrets.enc.yaml</code>: CloudFlare API token secret</li> </ul> <p>To decrypt and edit these files:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-22-1>1</a></span>
<span class=normal><a href=#__codelineno-22-2>2</a></span>
<span class=normal><a href=#__codelineno-22-3>3</a></span>
<span class=normal><a href=#__codelineno-22-4>4</a></span>
<span class=normal><a href=#__codelineno-22-5>5</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1></a><span class=c1># Decrypt and edit in one command</span>
<a id=__codelineno-22-2 name=__codelineno-22-2></a>sops<span class=w> </span>apps/certmanager/cloudflare_issuer.enc.yaml
<a id=__codelineno-22-3 name=__codelineno-22-3></a>
<a id=__codelineno-22-4 name=__codelineno-22-4></a><span class=c1># Or decrypt to a separate file</span>
<a id=__codelineno-22-5 name=__codelineno-22-5></a>sops<span class=w> </span>-d<span class=w> </span>apps/certmanager/secrets.enc.yaml<span class=w> </span>&gt;<span class=w> </span>secrets-decrypted.yaml
</code></pre></div></td></tr></table></div> <p>For more information on secret management, see <a href=../secretmanagement/ >Secret Management</a>.</p> <h2 id=testing-certificate-configuration-locally>Testing Certificate Configuration Locally<a class=headerlink href=#testing-certificate-configuration-locally title="Permanent link">#</a></h2> <p>Before committing changes to certificate configuration, test them locally:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-23-1> 1</a></span>
<span class=normal><a href=#__codelineno-23-2> 2</a></span>
<span class=normal><a href=#__codelineno-23-3> 3</a></span>
<span class=normal><a href=#__codelineno-23-4> 4</a></span>
<span class=normal><a href=#__codelineno-23-5> 5</a></span>
<span class=normal><a href=#__codelineno-23-6> 6</a></span>
<span class=normal><a href=#__codelineno-23-7> 7</a></span>
<span class=normal><a href=#__codelineno-23-8> 8</a></span>
<span class=normal><a href=#__codelineno-23-9> 9</a></span>
<span class=normal><a href=#__codelineno-23-10>10</a></span>
<span class=normal><a href=#__codelineno-23-11>11</a></span>
<span class=normal><a href=#__codelineno-23-12>12</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1></a><span class=c1># Build kustomization to preview resources</span>
<a id=__codelineno-23-2 name=__codelineno-23-2></a>kubectl<span class=w> </span>kustomize<span class=w> </span>apps/certmanager<span class=w> </span>--enable-helm
<a id=__codelineno-23-3 name=__codelineno-23-3></a>
<a id=__codelineno-23-4 name=__codelineno-23-4></a><span class=c1># Dry-run apply to validate syntax</span>
<a id=__codelineno-23-5 name=__codelineno-23-5></a>kubectl<span class=w> </span>apply<span class=w> </span>--dry-run<span class=o>=</span>client<span class=w> </span>-k<span class=w> </span>apps/certmanager
<a id=__codelineno-23-6 name=__codelineno-23-6></a>
<a id=__codelineno-23-7 name=__codelineno-23-7></a><span class=c1># Apply to test environment (if using Vagrant)</span>
<a id=__codelineno-23-8 name=__codelineno-23-8></a><span class=nb>export</span><span class=w> </span><span class=nv>KUBECONFIG</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$PWD</span><span class=s2>/shared/k3svm1/k3s.yaml&quot;</span>
<a id=__codelineno-23-9 name=__codelineno-23-9></a>kubectl<span class=w> </span>kustomize<span class=w> </span>apps/certmanager<span class=w> </span>--enable-helm<span class=w> </span><span class=p>|</span><span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>-
<a id=__codelineno-23-10 name=__codelineno-23-10></a>
<a id=__codelineno-23-11 name=__codelineno-23-11></a><span class=c1># Check ArgoCD sync diff</span>
<a id=__codelineno-23-12 name=__codelineno-23-12></a>argocd<span class=w> </span>app<span class=w> </span>diff<span class=w> </span><span class=m>01</span>-certmanager
</code></pre></div></td></tr></table></div> <h2 id=best-practices>Best Practices<a class=headerlink href=#best-practices title="Permanent link">#</a></h2> <ol> <li><strong>Use wildcard certificates</strong>: Reduces certificate count and simplifies management</li> <li><strong>Test with staging issuer</strong>: Always test new configurations with the staging issuer before production</li> <li><strong>Monitor certificate expiration</strong>: Set up alerts for certificates nearing expiration (built into kube-prometheus-stack)</li> <li><strong>Secure API tokens</strong>: Ensure CloudFlare API tokens have minimal required permissions</li> <li><strong>Encrypt sensitive data</strong>: Use SOPS to encrypt all configuration containing domain names, emails, or tokens</li> <li><strong>Document custom certificates</strong>: If creating application-specific certificates, document the reason for not using wildcards</li> <li><strong>Regular secret rotation</strong>: Rotate CloudFlare API tokens periodically (recommended annually)</li> </ol> <h2 id=related-documentation>Related Documentation<a class=headerlink href=#related-documentation title="Permanent link">#</a></h2> <ul> <li><a href=../secretmanagement/ >Secret Management</a>: SOPS encryption and decryption workflows</li> <li><a href=../reflector/ >Reflector</a>: Certificate distribution across namespaces</li> <li><a href=../network/ >Network Architecture</a>: Traefik ingress controller configuration</li> <li><a href=../argocd/ >ArgoCD</a>: Application deployment and sync waves</li> <li><a href=../monitoring/ >Monitoring</a>: Certificate expiration alerts</li> </ul> <h2 id=references>References<a class=headerlink href=#references title="Permanent link">#</a></h2> <ul> <li><a href="https://cert-manager.io/docs/">cert-manager documentation</a></li> <li><a href="https://letsencrypt.org/docs/rate-limits/">Let's Encrypt rate limits</a></li> <li><a href="https://developers.cloudflare.com/fundamentals/api/get-started/create-token/">CloudFlare API token documentation</a></li> <li><a href="https://cert-manager.io/docs/configuration/acme/dns01/">DNS-01 challenge documentation</a></li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 </div> Made with <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener"> Material for MkDocs </a> </div> <div class=md-social> <a href="https://github.com/madic-creates" target="_blank" rel="noopener" title="github.com" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href="https://chaos.social/@Madic" target="_blank" rel="noopener me" title="chaos.social" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href="https://www.geekbundle.org" target="_blank" rel="noopener" title="www.geekbundle.org" class="md-social__link"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m61.7 169.4 101.5 278C92.2 413 43.3 340.2 43.3 256c0-30.9 6.6-60.1 18.4-86.6m337.9 75.9c0-26.3-9.4-44.5-17.5-58.7-10.8-17.5-20.9-32.4-20.9-49.9 0-19.6 14.8-37.8 35.7-37.8.9 0 1.8.1 2.8.2-37.9-34.7-88.3-55.9-143.7-55.9-74.3 0-139.7 38.1-177.8 95.9 5 .2 9.7.3 13.7.3 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l77.5 230.4L249.8 247l-33.1-90.8c-11.5-.7-22.3-2-22.3-2-11.5-.7-10.1-18.2 1.3-17.5 0 0 35.1 2.7 56 2.7 22.2 0 56.7-2.7 56.7-2.7 11.5-.7 12.8 16.2 1.4 17.5 0 0-11.5 1.3-24.3 2l76.9 228.7 21.2-70.9c9-29.4 16-50.5 16-68.7m-139.9 29.3-63.8 185.5c19.1 5.6 39.2 8.7 60.1 8.7 24.8 0 48.5-4.3 70.6-12.1-.6-.9-1.1-1.9-1.5-2.9zm183-120.7c.9 6.8 1.4 14 1.4 21.9 0 21.6-4 45.8-16.2 76.2l-65 187.9C426.2 403 468.7 334.5 468.7 256c0-37-9.4-71.8-26-102.1M8 256a248 248 0 1 1 496 0 248 248 0 1 1-496 0m484.6 0a236.6 236.6 0 1 0-473.2 0 236.6 236.6 0 1 0 473.2 0"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>